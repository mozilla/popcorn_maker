/*! This Source Code Form is subject to the terms of the MIT license
 * If a copy of the MIT license was not distributed with this file, you can
 * obtain one at http://www.mozillapopcorn.org/butter-license.txt */
(function(){var a,b,c;(function(d){function j(a,b){if(a&&a.charAt(0)==="."&&b){b=b.split("/"),b=b.slice(0,b.length-1),a=b.concat(a.split("/"));var c,d;for(c=0;d=a[c];c++)if(d===".")a.splice(c,1),c-=1;else if(d===".."){if(c===1&&(a[2]===".."||a[0]===".."))break;c>0&&(a.splice(c-1,2),c-=2)}a=a.join("/")}return a}function k(a,b){return function(){return i.apply(d,g.call(arguments,0).concat([a,b]))}}function l(a){return function(b){return j(b,a)}}function m(a){return function(b){e[a]=b}}function n(a){if(f.hasOwnProperty(a)){var b=f[a];delete f[a],h.apply(d,b)}return e[a]}function o(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=j(a.slice(0,e),b),a=a.slice(e+1),d=n(c),d&&d.normalize?a=d.normalize(a,l(b)):a=j(a,b)):a=j(a,b),{f:c?c+"!"+a:a,n:a,p:d}}var e={},f={},g=[].slice,h,i;if(typeof c=="function")return;h=function(a,b,c,g){var h=[],i,j,l,p,q,r;g||(g=a);if(typeof c=="function"){!b.length&&c.length&&(b=["require","exports","module"]);for(p=0;p<b.length;p++){r=o(b[p],g),l=r.f;if(l==="require")h[p]=k(a);else if(l==="exports")h[p]=e[a]={},i=!0;else if(l==="module")j=h[p]={id:a,uri:"",exports:e[a]};else if(e.hasOwnProperty(l)||f.hasOwnProperty(l))h[p]=n(l);else{if(!r.p)throw a+" missing "+l;r.p.load(r.n,k(g,!0),m(l),{}),h[p]=e[l]}}q=c.apply(e[a],h),a&&(j&&j.exports!==d?e[a]=j.exports:i||(e[a]=q))}else a&&(e[a]=c)},a=i=function(a,b,c,e){return typeof a=="string"?n(o(a,b).f):(a.splice||(b.splice?(a=b,b=arguments[2]):a=[]),e?h(d,a,b,c):setTimeout(function(){h(d,a,b,c)},15),i)},i.config=function(){return i},b||(b=i),c=function(a,b,d){b.splice||(d=b,b=[]),c.unordered?f[a]=[a,b,d]:h(a,b,d)},c.amd={jQuery:!0}})(),c("../tools/almond",function(){}),function(){function a(){return!0}var b=function(){b.__waiting||(b.__waiting=[]),b.__waiting.push(arguments)};window.Butter||(window.Butter=b)}(),c("butter",function(){}),c("core/eventmanager",[],function(){function a(a){return a.listen&&a.unlisten}function b(b,c,d){if(!a(c))throw"Error: Object is not a valid event source: "+c;var e=d.length;while(e--)c.listen(d[e],b.dispatch)}function c(b,c,d){if(!a(c))throw"Error: Object is not a valid event source: "+c;var e=d.length;while(e--)c.unlisten(d[e],b.dispatch)}function d(a,b,c){var d,e;if(b[a]){d=b[a].slice(),e=d.length;while(e--)d[e](c)}}function e(a,b,c,e,f,g){var h,i,j;typeof c=="object"?(i={type:c.type,target:c.target,data:c.data},c=i.type):i={type:c+"",target:a,data:e},j=b+c,g=!0,g?d(j,f,i):(h=document.createEvent("CustomEvent"),h.initCustomEvent(j,!1,!1,i),document.dispatchEvent(h))}function f(a,b,c,d,e,f){var g,h;if(typeof c=="object")for(g in c)c.hasOwnProperty(g)&&a.listen(g,c[g]);else h=b+c,e[h]||(e[h]=[],document.addEventListener(h,function(a){f(h,a)},!1)),e[h].push(d)}function g(a,b,c,d,e,f){var g,h,i,j=b+c;if(typeof c=="object")for(i in c)c.hasOwnProperty(i)&&a.unlisten(i,c[i]);else{g=e[j];if(!g)return;d&&(h=g.indexOf(d),h>-1&&g.splice(h,1));if(!d||g.length===0)delete e[j],document.removeEventListener(j,function(a){f(j,a)},!1)}}function i(i){if(!i||a(i))return;var j={},k="butter-"+h++ +":",l=function(a,b){d(a,j,b.detail)};return i.chain=function(a,c){b(this,a,c)},i.unchain=function(a,b){c(this,a,b)},i.dispatch=function(a,b,c){e(this,k,a,b,j,!!c)},i.listen=function(a,b){f(this,k,a,b,j,l)},i.unlisten=function(a,b){g(this,k,a,b,j,l)},i}var h=Date.now();return i}),function(a){var b=!1;c("core/logger",[],function(){function c(a){this.log=function(c){b&&console.log("["+a+"] "+c)},this.error=function(c){if(b)throw new Error("["+a+"] "+c)}}return c.enabled=function(c){return c!==a&&(b=!!c),b},c})}(),function(a){function d(a,c,d){var e=b[a];return!e||!e.validate?c:e.validate(c)}var b={baseDir:{name:"{{baseDir}}",defaultValue:"./",validate:function(a){return a.replace(/\/?$/,"/")}}};c("core/config",[],function(){function c(e){function h(b){var c=g.length;while(c--)if(g[c].value(b)!==a)return g[c];return f}function i(d,e){if(d===a)return d;var f=d,g,i,j,k;for(var l in b)b.hasOwnProperty(l)&&(g=b[l],k=h(l),i=k instanceof c?k.value(l):k[l],j=i?i:g.defaultValue,f=f.replace?f.replace(g.name,j,"g"):f);return f}function j(b,c){if(b===a)return b;for(var d in b)b.hasOwnProperty(d)&&(typeof b[d]=="object"?b[d]=j(b[d],c):b[d]=i(b[d],c));return b}if(typeof e!="object")throw"Config Error: expected parsed config object";var f=e,g=[];this.value=function(b,e){var f=h(b);return f instanceof c?f.value(b,e):(e!==a&&(f[b]=d(b,e,f)),typeof f[b]=="object"?j(f[b],f):i(f[b],f))},this.merge=function(a){g.push(a)}}var e={parse:function(a){var b;try{return b=JSON.parse(a),new c(b)}catch(d){throw"Config.parse Error: unable to parse config string. Error was: "+d.message}}};return e})}(),c("util/dragndrop",[],function(){function o(){k=!1;if(g){for(var b=h.length-1;b>=0;--b)h[b].update();window.setTimeout(o,a)}}function p(b){j[0]=i[0],j[1]=i[1],i=[b.clientX,b.clientY];var c=[],d,e,k,l;if(g)for(k=h.length-1;k>=0;--k)c.push(h[k]);else{var m;g=!0,window.setTimeout(o,a);for(k=h.length-1;k>=0;--k)m=h[k],m.start(b),c.push(h[k])}for(k=c.length-1;k>=0;--k){e=c[k];for(l=f.length-1;l>=0;--l)d=f[l],!d.element.id||e.element.id===d.element.id||!d.drag(e.element.getBoundingClientRect())?d.forget(e):d.remember(e)}}function q(a){g=!1,window.removeEventListener("mousemove",p,!1);var b;for(var c=h.length-1;c>=0;--c)b=h[c],b.dragging&&b.stop()}function r(a){if(a.which!==1)return;a.preventDefault(),a.stopPropagation(),window.addEventListener("mousemove",p,!1),window.addEventListener("mouseup",q,!1)}function s(a){var b=getComputedStyle(a),c=b.getPropertyValue("padding-top"),d=b.getPropertyValue("padding-left"),e=b.getPropertyValue("padding-bottom"),f=b.getPropertyValue("padding-right");return{top:Number(c.substring(0,c.indexOf("px"))),left:Number(d.substring(0,d.indexOf("px"))),bottom:Number(e.substring(0,e.indexOf("px"))),right:Number(f.substring(0,f.indexOf("px")))}}function t(){return{top:0,left:0,right:window.innerWidth,bottom:window.innerHeight}}function u(a,b){var c=b.parentNode;while(c){if(c===a)return!0;c=c.parentNode}return!1}function v(a){var b=getComputedStyle(a).zIndex;if(isNaN(b)){b=0;var c=a.parentNode;while(c&&[window,document].indexOf(c)===-1){var d=getComputedStyle(c);if(d){var e=d.zIndex;isNaN(e)&&e>b&&(b=e)}c=c.parentNode}}}function w(){f=f.sort(function(a,b){var c=a.element,d=b.element,e=v(c),f=v(d);return u(c,d)?-1:u(d,c)?1:e-f})}function x(d,f){function o(f){function s(){var a=q-p,f=h+a,i=o-a;if(i<e)return;l&&l.scrollLeft>0&&g.left+a<m.left-c&&(l.scrollLeft-=b,f-=b,i+=b,p+=b),f<0&&(i+=f,f=0),d.style.left=f+"px",d.style.width=i+"px",n=d.getBoundingClientRect()}function t(a){window.removeEventListener("mousemove",u,!1),window.removeEventListener("mouseup",t,!1),clearInterval(k),k=-1,j()}function u(b){q=b.clientX,k===-1&&(k=setInterval(s,a),i())}f.stopPropagation();var g=d.getBoundingClientRect(),h=d.offsetLeft,o=d.offsetWidth,p=f.clientX,q,r;n=d.getBoundingClientRect(),r=f.clientX-n.left,m=l.getBoundingClientRect(),window.addEventListener("mousemove",u,!1),window.addEventListener("mouseup",t,!1)}function p(f){function r(){var a=p-o,f=h+a;if(f<e)return;l&&l.scrollLeft<l.scrollWidth-m.width&&p>m.right+c&&(l.scrollLeft+=b,o-=b),f+g>d.offsetParent.offsetWidth&&(f=d.offsetParent.offsetWidth-g),d.style.width=f+"px",n=d.getBoundingClientRect()}function s(a){window.removeEventListener("mousemove",t,!1),window.removeEventListener("mouseup",s,!1),clearInterval(k),k=-1,j()}function t(b){p=b.clientX,k===-1&&(k=setInterval(r,a),i())}f.stopPropagation();var g=d.offsetLeft,h=d.offsetWidth,o=f.clientX,p,q;n=d.getBoundingClientRect(),l&&(m=l.getBoundingClientRect()),q=f.clientX-n.left,window.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",s,!1)}var g=document.createElement("div"),h=document.createElement("div"),i=f.start||function(){},j=f.stop||function(){},k=-1,l=f.scroll,m,n;return g.className="handle left-handle",h.className="handle right-handle",d.appendChild(g),d.appendChild(h),g.addEventListener("mousedown",o,!1),h.addEventListener("mousedown",p,!1),{destroy:function(){g.removeEventListener("mousedown",o,!1),h.removeEventListener("mousedown",p,!1),d.removeChild(g),d.removeChild(h)}}}function y(a,b){var c=b.image,d=b.start||function(){},e=b.stop||function(){},f=l.length;l[f]=a,a.setAttribute("draggable",!0),a.addEventListener("dragstart",function(b){m=a,b.dataTransfer.effectAllowed="all",b.dataTransfer.setData("text",f);if(c){var e=document.createElement("img");e.src=c.src,b.dataTransfer.setDragImage(e,e.width/2,e.height/2)}d()}),a.addEventListener("dragend",function(a){m=null,e()}),a.addEventListener("drop",function(a){})}function z(a,b){function n(b){b.preventDefault(),b.stopPropagation(),c&&a.classList.remove(c);var e=b.dataTransfer.getData("text"),f=l[e]||m;f&&d(f,[b.clientX,b.clientY])}function o(a){a.preventDefault(),a.stopPropagation(),a.dataTransfer.dropEffect="copy"}function p(b){c&&a.classList.add(c);var d=b.dataTransfer.getData("text"),f=l[d]||m;f&&e(f,[b.clientX,b.clientY])}function q(b){c&&a.classList.remove(c);var d=b.dataTransfer.getData("text"),e=l[d]||m;e&&g(e,[b.clientX,b.clientY])}b=b||{};var c=b.hoverClass,d=b.drop||function(){},e=b.over||function(){},g=b.out||function(){},h={},j={},k=0;return a.addEventListener("drop",n,!1),a.addEventListener("dragover",o,!1),a.addEventListener("dragenter",p,!1),a.addEventListener("dragleave",q,!1),h={element:a,remember:function(b){!j[b.element.id]&&!b.droppable&&(k++,a.classList.add(c),j[b.element.id]=b,b.droppable=h,e(b.element))},forget:function(b){j[b.element.id]&&b.droppable&&(--k===0&&a.classList.remove(c),b.droppable=null,g(b.element),delete j[b.element.id])},drop:function(b){j[b.element.id]&&(--k===0&&a.classList.remove(c),b.droppable=null,d(b.element,i),delete j[b.element.id])},drag:function(b){var c=a.getBoundingClientRect(),d=Math.max(b.left,c.left),e=Math.max(b.top,c.top),f=Math.min(b.right,c.right),g=Math.min(b.bottom,c.bottom);if(f<d||g<e)return!1;var h=[f-d,g-e];return h[0]*h[1]/2>b.width*b.height/4?!0:!1},destroy:function(){var b=f.indexOf(h);b>-1&&f.splice(b,1),a.removeEventListener("drop",n,!1),a.removeEventListener("dragover",o,!1),a.removeEventListener("dragenter",p,!1),a.removeEventListener("dragleave",q,!1)}},f.push(h),w(),h}function A(a,e){function F(){var b=i[0]-m[0],c=i[1]-m[1];if(!j||j.indexOf("x")>-1)a.style.left=b-u.left+"px";if(!j||j.indexOf("y")>-1)a.style.top=c-u.top+"px";p=a.getBoundingClientRect()}function G(){k||(p.right>q.right+c?(k=!0,g.scrollLeft+=w):p.left<q.left-c&&(k=!0,g.scrollLeft-=w)),C.updateRects()}function H(){var b=p.left,d=p.top,e=b+p.width,f=d+p.height;if(!j||j.indexOf("y")>-1)d<v.top?d=v.top:f>v.bottom&&(d=v.bottom-p.height),a.style.top=d-u.top-E.top+"px";if(!j||j.indexOf("x")>-1)e>q.right+c?(b=q.right+c-p.width,e=b+p.width):b<q.left-c&&(b=q.left-c,e=b+p.width),b<v.left?b=v.left:e>v.right&&(b=v.right-p.width),a.style.left=b-u.left-E.left+"px";p=a.getBoundingClientRect()}e=e||{};var f=e.containment,g=e.scroll,j=e.axis,l=e.revert,m,o=a,p,q,u,v,w=e.scrollAmount||b,x,y=e.start||function(){},z=e.stop||function(){return!1},A,B=null,C={destroy:function(){a.removeEventListener("mousedown",r,!1)}},D=!1,E=n;return f&&(E=s(f)),C.updateRects=function(){v=f?f.getBoundingClientRect():t(),u=a.offsetParent?a.offsetParent.getBoundingClientRect():v,q=g?g.getBoundingClientRect():v,p=a.getBoundingClientRect()},a.addEventListener("mousedown",r,!1),C.update=function(){F(),g&&G(),H()},C.start=function(b){D=!0,A=[a.offsetLeft,a.offsetTop],C.updateRects(),m=[b.clientX-p.left,b.clientY-p.top],y()},C.stop=function(){D=!1,z(),!B&&l?(a.style.left=A[0]+"px",a.style.top=A[1]+"px"):B&&B.drop(C)},Object.defineProperties(C,{selected:{enumerable:!0,get:function(){for(var a=h.length-1;a>=0;--a)if(h[a].element.id===o.id)return!0;return!1},set:function(b){if(b)x=getComputedStyle(a).getPropertyValue("z-index"),a.style.zIndex=d,h.push(C);else{a.style.zIndex=x;for(var c=h.length-1;c>=0;--c)if(h[c].element.id===o.id){h.splice(c,1);return}}}},dragging:{enumerable:!0,get:function(){return D}},element:{enumerable:!0,get:function(){return o}},droppable:{enumerable:!0,get:function(){return B},set:function(a){B=a}}}),C}function B(a,b){function n(b){var c=b.cloneNode(!1);return c.classList.add("placeholder"),a.replaceChild(c,b),c}function o(a){h.style.top=i-a+"px"}function p(b){if(!j)j=!0,l=n(h),a.appendChild(h),h.style.position="absolute",h.style.zIndex=d,o(0);else{var f=g-b.clientY;o(f);var i=h.getBoundingClientRect();for(var m=e.length-1;m>=0;--m){var p=e[m];if(p===h)continue;var q=p.getBoundingClientRect(),r=Math.max(i.left,q.left),s=Math.max(i.top,q.top),t=Math.min(i.right,q.right),u=Math.min(i.bottom,q.bottom);if(t<r||u<s)continue;var v=[t-r,u-s];if(v[0]*v[1]/2>i.width*i.height/4){k=p;var w=n(k);a.replaceChild(k,l),l=w;var x=[],y=a.childNodes;for(var z=0,A=y.length;z<A;++z){var B=y[z];B!==h&&(B!==l?x.push(B):x.push(h))}c(x)}}}}function q(a){if(a.which!==1)return;j=!1,h=a.target,i=h.offsetTop;var b=getComputedStyle(h);m=b.getPropertyValue("z-index"),g=a.clientY,window.addEventListener("mouseup",r,!1),window.addEventListener("mousemove",p,!1)}function r(b){h.style.zIndex=m,window.removeEventListener("mouseup",r,!1),window.removeEventListener("mousemove",p,!1),j=!1,l&&(h.style.zIndex="",h.style.position="",h.style.top="",a.replaceChild(h,l),l=null)}var c=b.change||function(){},e=[],f={},g=0,h,i,j,k,l,m;return f.addItem=function(a){e.push(a),a.addEventListener("mousedown",q,!1)},f.removeItem=function(a){e.splice(e.indexOf(a),1),a.removeEventListener("mousedown",q,!1)},f}var a=16,b=10,c=20,d=2147483647,e=15,f=[],g=!1,h=[],i=[0,0],j=[0,0],k=!1,l=[],m,n={top:0,left:0,bottom:0,right:0};return{draggable:A,droppable:z,helper:y,resizable:x,sortable:B}}),c("ui/position-tracker",[],function(){var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();return function(b,c){function f(){var a=b.getBoundingClientRect();if(a.left!==d.left||a.top!==d.top)d={left:a.left,top:a.top,width:a.width,height:a.height},document.body.scrollTop<0&&(d.top+=document.body.scrollTop),c(d)}function g(){f(),e||a(g)}var d={},e=!1;return g(),window.addEventListener("scroll",f,!1),{destroy:function(){e=!0,window.removeEventListener("scroll",f,!1)}}}}),c("ui/page-element",["core/logger","core/eventmanager","util/dragndrop","ui/position-tracker"],function(a,b,c,d){var e=function(){};return function(a,f,g){function r(){i.classList.remove("blink"),!p&&!o&&(i.style.visibility="hidden"),o||(i.classList.remove("on"),q.blink=l),i.removeEventListener("transitionend",r,!1),i.removeEventListener("oTransitionEnd",r,!1),i.removeEventListener("webkitTransitionEnd",r,!1)}var h=typeof a=="string"?document.getElementById(a):a,i=document.createElement("div"),j=f||{},k=g||{},l,m,n,o=!1,p=!1,q=this;b(q),m=d(h,function(a){i.style.left=a.left+"px",i.style.top=a.top+"px",i.style.width=a.width+"px",i.style.height=a.height+"px",q.dispatch("moved",a)}),this.highlight=function(a){a?(q.blink=e,o=!0,i.style.visibility="visible",i.classList.add("on"),i.classList.remove("blink"),i.removeEventListener("transitionend",r,!1),i.removeEventListener("oTransitionEnd",r,!1),i.removeEventListener("webkitTransitionEnd",r,!1)):(q.blink=l,o=!1,i.classList.remove("on"),p||(i.style.visibility="hidden"))},window.addEventListener("dragstart",function(a){i.style.visibility="visible",p=!0},!1),window.addEventListener("dragend",function(a){i.classList.contains("blink")||(i.style.visibility="hidden"),p=!1},!1),this.destroy=function(){m.destroy(),i.parentNode&&i.parentNode.removeChild(i),n&&n.destroy()},i.className="butter-highlight ",i.setAttribute("data-butter-exclude","true"),k.highlightClass&&(i.className+=k.highlightClass),i.style.visibility="hidden",this.blink=l=function(){q.blink=e,i.classList.add("on"),setTimeout(function(){i.classList.add("blink","true")},0),i.style.visibility="visible",i.addEventListener("transitionend",r,!1),i.addEventListener("oTransitionEnd",r,!1),i.addEventListener("webkitTransitionEnd",r,!1)},h&&(document.body.appendChild(i),h.setAttribute("butter-clean","true"),n=c.droppable(i,{over:function(a){if(a.getAttribute("data-butter-draggable-type")!=="plugin")return;q.highlight(!0),j.over&&j.over()},out:function(a){if(a.getAttribute("data-butter-draggable-type")!=="plugin")return;q.highlight(!1),j.out&&j.out()},drop:function(a){if(a.getAttribute("data-butter-draggable-type")!=="plugin")return;q.highlight(!1),j.drop&&j.drop(a)}})),this.highlightElement=i,Object.defineProperties(this,{element:{enumerable:!0,get:function(){return h}}})}}),function(){c("core/target",["core/logger","core/eventmanager","ui/page-element"],function(a,b,c){var d=0,e=function(e){e=e||{};var f="Target"+d++,g=new a(f),h=e.name||f,i=e.element,j,k=this;b(k),typeof i=="string"&&(i=document.getElementById(i)),i?j=new c(i,{drop:function(a){k.dispatch("trackeventrequested",{element:a,target:k})}},{highlightClass:"butter-target-highlight"}):g.log("Warning: Target element is null."),this.destroy=function(){j&&j.destroy()},Object.defineProperties(this,{view:{enumerable:!0,get:function(){return j}},name:{enumerable:!0,get:function(){return h}},id:{enumerable:!0,get:function(){return f}},elementID:{enumerable:!0,get:function(){if(i)return i.id}},element:{enumerable:!0,get:function(){return i}},isDefault:{enumerable:!0,get:function(){return i&&i.hasAttribute("data-butter-default")?!0:!1}},json:{enumerable:!0,get:function(){var a="";return i&&i.id&&(a=i.id),{id:f,name:h,element:a}},set:function(a){a.name&&(h=a.name),a.element&&(i=document.getElementById(a.element))}}})};return e})}(),c("util/time",[],function(){function b(b){return Math.round(b*Math.pow(10,a))/Math.pow(10,a)}var a=3,c={roundTime:b};return Object.defineProperties(c,{timeAccuracy:{enumerable:!0,get:function(){return a},set:function(b){a=b}}}),c}),c("core/views/trackevent-view",["core/logger","core/eventmanager","util/dragndrop"],function(a,b,c){var d=0;return function(a,e,f){function t(a){n[0].style.visibility=a?"visible":"hidden",n[1].style.visibility=a?"visible":"hidden"}function u(){h.style.left=k*i+"px",h.style.width=(l-k)*i+"px"}function v(){h.style.top="0px";var a=h.getClientRects()[0];k=h.offsetLeft/i,l=k+a.width/i,r.update({start:k,end:l})}function w(a){p.selected=!0,h.setAttribute("selected",!0)}function x(a){p.selected=!1,h.removeAttribute("selected")}var g="TrackEventView"+d++,h=document.createElement("div"),i=1,j=e,k=f.start||0,l=f.end||k+1,m,n,o=document.createElement("div"),p,q,r=a,s=this;b(s),h.appendChild(o),this.setToolTip=function(a){h.title=a},this.update=function(a){a=a||{},h.style.top="0px",isNaN(a.start)||(k=a.start),isNaN(a.end)||(l=a.end),u()},Object.defineProperties(this,{trackEvent:{enumerable:!0,get:function(){return r}},element:{enumerable:!0,get:function(){return h}},start:{enumerable:!0,get:function(){return k},set:function(a){k=a,u()}},end:{enumerable:!0,get:function(){return l},set:function(a){l=a,u()}},type:{enumerable:!0,get:function(){return j},set:function(a){j=a,o.innerHTML=j,h.setAttribute("data-butter-trackevent-type",j)}},selected:{enumerable:!0,get:function(){return p.selected},set:function(a){a?w():x()}},zoom:{enumerable:!0,get:function(){return i},set:function(a){i=a,u()}},id:{enumerable:!0,configurable:!1,get:function(){return g}},parent:{enumerabled:!0,get:function(){return m},set:function(b){m=b,p&&(p.destroy(),p=null),q&&(t(!1),q.destroy(),q=null,n=null),m&&(m.element&&m.element.parentNode&&m.element.parentNode.parentNode&&(p=c.draggable(h,{containment:m.element.parentNode,scroll:m.element.parentNode.parentNode,start:function(){s.dispatch("trackeventdragstarted")},stop:function(){s.dispatch("trackeventdragstopped"),v()},revert:!0}),q=c.resizable(h,{containment:m.element.parentNode,scroll:m.element.parentNode.parentNode,stop:v}),h.setAttribute("data-butter-draggable-type","trackevent"),h.setAttribute("data-butter-trackevent-id",a.id),n||(n=h.querySelectorAll(".handle"),n&&n.length===2&&(h.addEventListener("mouseover",function(a){t(!0)},!1),h.addEventListener("mouseout",function(a){t(!1)},!1),t(!1)))),u())}}}),h.className="butter-track-event",s.type=j,h.id=g,s.update(f),h.addEventListener("mousedown",function(b){s.dispatch("trackeventmousedown",{originalEvent:b,trackEvent:a})},!0),h.addEventListener("mouseup",function(b){s.dispatch("trackeventmouseup",{originalEvent:b,trackEvent:a})},!1),h.addEventListener("mouseover",function(b){s.dispatch("trackeventmouseover",{originalEvent:b,trackEvent:a})},!1),h.addEventListener("mouseout",function(b){s.dispatch("trackeventmouseout",{originalEvent:b,trackEvent:a})},!1),h.addEventListener("dblclick",function(b){s.dispatch("trackeventdoubleclicked",{originalEvent:b,trackEvent:a})},!1)}}),c("core/views/track-view",["core/logger","core/eventmanager","util/dragndrop"],function(a,b,c){var d=0;return function(a){function o(){m=c.droppable(j,{hoverClass:"draggable-hover",drop:function(a,b){var c=a.getAttribute("data-butter-draggable-type"),d,e,h=j.getBoundingClientRect();c==="plugin"?(e=b[0]-h.left,d=e/h.width*k,g.dispatch("plugindropped",{start:d,track:f,type:a.getAttribute("data-butter-plugin-type")})):c==="trackevent"&&a.parentNode!==j&&(e=a.offsetLeft,d=e/h.width*k,g.dispatch("trackeventdropped",{start:d,track:f,trackEvent:a.getAttribute("data-butter-trackevent-id")}))}})}function p(){j.style.width=k*n+"px"}var e="TrackView"+d++,f=a,g=this,h=[],i=[],j=document.createElement("div"),k=1,l,m,n=1;b(g),j.className="butter-track",j.id=e,Object.defineProperties(this,{element:{enumerable:!0,configurable:!1,get:function(){return j}},zoom:{enumerable:!0,get:function(){return n},set:function(a){n=a,p();for(var b=0,c=h.length;b<c;++b)h[b].zoom=n}},duration:{enumerable:!0,get:function(){return k},set:function(a){k=a,p();for(var b=0,c=h.length;b<c;++b)h[b].update()}},parent:{enumerable:!0,get:function(){return l},set:function(a){l=a,m&&(m.destroy(),m=null),l&&o();for(var b=0,c=h.length;b<c;++b)h[b].parent=g}}}),this.addTrackEvent=function(a){var b=a.view.element;j.appendChild(b),h.push(a.view),i.push(a.view.element),a.view.zoom=n,a.view.parent=g,g.chain(a,["trackeventmousedown","trackeventmouseover","trackeventmouseout"])},this.removeTrackEvent=function(a){var b=a.view.element;j.removeChild(b),h.splice(h.indexOf(a.view),1),i.splice(h.indexOf(a.view.element),1),a.view.parent=null,g.unchain(a,["trackeventmousedown","trackeventmouseover","trackeventmouseout"])}}}),c("core/popcorn-wrapper",["core/logger","core/eventmanager"],function(a,b){var c=/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu|vimeo|soundcloud|baseplayer)/,d=100,e=1e4,f=1e4;return function(b,g){function u(){for(var a in j)j.hasOwnProperty(a)&&p.on(a,j[a])}function v(a){var b=c.exec(a);return b?(q=b[1],q==="youtu"&&(q="youtube")):q="object",q}function w(a){var b=document.getElementById(a);if(q!=="object"&&b&&["VIDEO","AUDIO"].indexOf(b.nodeName)!==-1){var c=b.parentNode,d=document.createElement("div"),e;d.id=b.id,e=b.attributes;if(e)for(var f=e.length-1;f>=0;f--){var g=e[f].nodeName;d.setAttribute(g,b.getAttribute(g))}b.className&&(d.className=b.className),c.replaceChild(d,b),d.setAttribute("data-butter","media")}}function y(a){var b=new Function("",a),c=b();if(!c){var d=document.createElement("script");d.innerHTML=a,document.head.appendChild(d),c=window.Popcorn.instances[window.Popcorn.instances.length-1]}p=c}function z(a,b,c,e){function i(){if(g)return;a()?(h=!0,b()):setTimeout(i,d)}var g=!1,h=!1;setTimeout(function(){h||(g=!0,c())},f),i()}function A(a,b){z(function(){return p&&p.media.readyState>=1&&p.duration()>0},a,b,f)}function B(a,b){q!=="object"?(n(q),z(function(){return!!window.Popcorn[q]},a,b,e)):a()}var h=b,i=new a(h+"::PopcornWrapper"),j=g.popcornEvents||{},k=g.prepare||function(){},l=g.constructing||function(){},m=g.fail||function(){},n=g.playerTypeRequired||function(){},o=g.timeout||function(){},p,q,r={},s=!1,t=this;this.unbind=function(){try{p.destroy(),p=undefined}catch(a){i.log("WARNING: Popcorn did NOT get destroyed properly: \n"+a.message+"\n"+a.stack)}},this.interruptLoad=function(){s=!0},this.updateEvent=function(a){var b=a.popcornOptions,c=a.id,d=r[c],e=null;p&&(d&&p.getTrackEvent(d)&&p.removeTrackEvent(d),p[a.type]&&(p[a.type](b),r[c]=p.getLastTrackEventId(),e=p.getTrackEvent(r[c]),a.popcornTrackEvent=e,a.view&&(e.toString?a.view.setToolTip(e.toString()):a.view.setToolTip(JSON.stringify(b)))))},this.destroyEvent=function(a){var b=a.id,c=r[b];p&&(c&&p.getTrackEvent(c)&&p.removeTrackEvent(c),delete r[b])},this.prepare=function(a,b,c,d,e){function f(a){s=!0,o(a)}function g(a){s=!0,i.log(a),m(a)}var h=a;if(typeof a!="string"){if(!a.length)throw"URL is invalid: empty array or not a string.";h=a[0]}v(h);if(!b){i.log("Warning: tried to prepare media with null target.");return}if(!p)try{B(function(){w(b),y(x(c,a,b,null,d,e)),u(),l&&l(),A(k,f)},f)}catch(j){g(j)}};var x=this.generatePopcornString=function(a,b,c,d,e,f,g){e=e||{},f=f||{};var h="",j,k,l,m;typeof b!="string"?b=JSON.stringify(b):b="'"+b+"'",a?a=", "+JSON.stringify(a):a=", {}",typeof c!="string"&&(c&&c.id?c=c.id:i.log("WARNING: Unexpected non-string Popcorn target: "+c));if(!q)throw new Error("Media type not generated yet. Please specify a url for media objects before generating a popcorn string.");f.init&&(h+=f.init+"\n"),e.init&&(h+=e.init+"();\n"),q==="baseplayer"?h+="Popcorn.player( 'baseplayer' );\nvar popcorn = Popcorn.baseplayer( '#"+c+"' "+a+" );\n":h+="var popcorn = Popcorn.smart( '#"+c+"', "+b+a+" );\n",f.beforeEvents&&(h+=f.beforeEvents+"\n"),e.beforeEvents&&(h+=e.beforeEvents+"( popcorn );\n");if(p&&g)for(l=g.length-1;l>=0;l--){a=g[l].popcornOptions,k={};for(m in a)a.hasOwnProperty(m)&&a[m]!==undefined&&(k[m]=a[m]);try{j=JSON.stringify(k,null,4)}catch(n){j=!1,i.log("WARNING: Unable to export event options: \n"+n.message)}j&&(h+="popcorn."+g[l].type+"("+j+");\n")}return f.afterEvents&&(h+=f.afterEvents+"\n"),e.afterEvents&&(h+=e.afterEvents+"( popcorn );\n"),d=d||"inline",d==="event"?(h="\ndocument.addEventListener('DOMContentLoaded',function(e){\n"+h,h+="\n},false);"):h+="\n return popcorn;",h};this.play=function(){p.play()},this.pause=function(){p.pause()},this.clear=function(a){typeof a=="string"&&(a=document.getElementById(a));if(!a){i.log("Warning: tried to clear media with null target.");return}p&&t.unbind();while(a.firstChild)a.removeChild(a.firstChild);["AUDIO","VIDEO"].indexOf(a.nodeName)>-1&&(a.currentSrc="",a.src="",a.removeAttribute("src"))},Object.defineProperties(this,{volume:{enumerable:!0,set:function(a){p&&p.volume(a)},get:function(){return p?p.volume():!1}},muted:{enumerable:!0,set:function(a){p&&(a?p.mute():p.unmute())},get:function(){return p?p.muted():!1}},currentTime:{enumerable:!0,set:function(a){p&&p.currentTime(a)},get:function(){return p?p.currentTime():0}},duration:{enumerable:!0,get:function(){return p?p.duration():0}},popcorn:{enumerable:!0,get:function(){return p}},paused:{enumerable:!0,get:function(){return p?p.paused():!0},set:function(a){p&&(a?p.pause():p.play())}}})}}),c("ui/logo-spinner",[],function(){return function(a){var b=document.createElement("div"),c=document.createElement("div");return b.className="butter-logo-spin-outer",c.className="butter-logo-spin-inner",b.appendChild(c),a&&a.appendChild(b),{element:b,start:function(){b.classList.remove("fade-out"),c.classList.add("active")},stop:function(a){b.classList.add("fade-out"),setTimeout(function(){c.classList.remove("active"),a&&a()},500)}}}}),c("ui/widget/textbox",[],function(){function a(b){var c=b.target;c.select(),c.removeEventListener("focus",a,!1)}function b(a){a.preventDefault();var c=a.target;c.removeEventListener("mouseup",b,!1)}function c(c){c.addEventListener("focus",a,!1),c.addEventListener("mouseup",b,!1)}return function(a){if(!a||a.type!=="text")throw"Textbox: Expected an input element of type text";return a.addEventListener("blur",function(a){c(a.target)},!1),c(a),a}}),c("core/page",["core/logger","core/eventmanager"],function(a,b){return function(a,c){var d="{popcorn-js}/players/{type}/popcorn.{type}.js",e;b(this),this.scrape=function(){var a=document.body,b=a.querySelectorAll("*[data-butter='target']"),c=a.querySelectorAll("*[data-butter='media']");return{media:c,target:b}},this.prepare=function(b){a.load([{type:"js",url:"{popcorn-js}/popcorn.js",check:function(){return!!window.Popcorn}},{type:"js",url:"{popcorn-js}/modules/player/popcorn.player.js",check:function(){return!!window.Popcorn&&!!window.Popcorn.player}}],b,null,!0)},this.addPlayerType=function(b,c){a.load({type:"js",url:d.replace(/\{type\}/g,b),check:function(){return!!Popcorn[b]}},c)},this.getHTML=function(a){var b,c,d,f,g,h,i,j,k,l,m;b=document.createElement("html"),e?d=e.body.cloneNode(!0):d=document.getElementsByTagName("body")[0].cloneNode(!0),c=document.getElementsByTagName("head")[0].cloneNode(!0),i=Array.prototype.slice.call(c.querySelectorAll("*[data-butter-exclude]")),i=i.concat(Array.prototype.slice.call(c.querySelectorAll("*[data-requiremodule]")));for(f=0,g=i.length;f<g;++f)j=i[f],j.parentNode.removeChild(j);m=d.querySelectorAll("*[data-butter='media']");for(f=0,g=m.length;f<g;++f)j=m[f],k=document.getElementById(j.id).cloneNode(!0),["VIDEO","AUDIO"].indexOf(k.nodeName)===-1&&(k.innerHTML=""),j.parentNode.replaceChild(k,j),k.removeAttribute("data-butter-source");h=d.querySelectorAll('*[butter-clean="true"]');for(f=0,g=h.length;f<g;++f)j=h[f],j.removeAttribute("butter-clean"),j.removeAttribute("data-butter"),j.removeAttribute("data-butter-default"),j.classList?j.classList.remove("ui-droppable"):j.className=j.className.replace(/ui-droppable/g,"");i=d.querySelectorAll("*[data-butter-exclude]");for(f=0,g=i.length;f<g;++f)j=i[f],j.parentNode.removeChild(j);l=document.createElement("base"),l.href=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1),c.insertBefore(l,c.firstChild),b.appendChild(c),b.appendChild(d);if(a)for(f=0;f<a.length;++f){var n=document.createElement("script");n.type="text/javascript",n.innerHTML="(function(){\n"+a[f]+"\n}());",d.appendChild(n)}return this.dispatch("getHTML",b),"<html>"+b.innerHTML+"</html>"},this.snapshotHTML=function(){e={head:document.getElementsByTagName("head")[0].cloneNode(!0),body:document.getElementsByTagName("body")[0].cloneNode(!0)}},this.eraseSnapshot=function(){e=null}}}),c("core/comm",["./eventmanager"],function(a){var b=1,c=function(c,d){function j(){h||(i||e.dispatch("error",{type:"connectionclosed"}),k())}function k(){i=!1,e.send("ping"),setTimeout(j,1e3)}var e=this,f,g=b++,h=!1,i=!1;a(e),c.addEventListener("message",function(a){a.source===c&&typeof a.data=="object"&&a.data.context&&(a.data.type==="pong"?i=!0:e.dispatch(a.data.type,a.data.data))},!1),e.listen("ready",function(a){clearInterval(f),d(),k()}),f=setInterval(function(){e.send("ready","ready")},100),this.send=function(a,b){c.postMessage({type:a,context:g,data:b},"*")},this.destroy=function(){h=!0,clearInterval(f)}};return c}),c("dialog/modal",[],function(){var a;return function(b){a||(a=document.createElement("div"),a.id="butter-modal-container",a.setAttribute("data-butter-exclude",!0),document.body.appendChild(a));var c=document.createElement("div");c.className="layer",b&&typeof b=="string"&&(c.className+=b),a.appendChild(c),setTimeout(function(){c.className+=" fade-in"},10),this.destroy=function(){a.removeChild(c)},Object.defineProperties(this,{element:{enumerable:!0,get:function(){return c}}})}}),c("dialog/iframe-dialog",["core/comm","core/eventmanager","dialog/modal"],function(a,b,c){return function(d){function n(a){e.dispatch(a.type,a.data)}function o(a){e.dispatch(a.type,a.data),e.close()}d=d||{};if(!d.url)throw new Error("IFRAME dialog requires a url.");var e=this,f=d.url,g=d.parent,h=!1,i,j=[],k,l,m=d.events||{};b(e),this.modal=d.modal,this.close=function(){e.send("close"),setTimeout(function(){g.removeChild(i),l&&(l.destroy(),l=undefined),k.unlisten("submit",n),k.unlisten("cancel",o),k.unlisten("close",e.close),k.destroy(),h=!1,window.removeEventListener("beforeunload",e.close,!1);for(var a in m)a!=="close"&&e.unlisten(a,m[a]);e.dispatch("close"),e.unlisten("close",m.close)},0)},this.open=function(b){if(h)return;e.modal&&(l=new c(e.modal));for(var d in b)b.hasOwnProperty(d)&&(m[d]=b[d]);var p=l?l.element:document.body;g=g||p,i=document.createElement("iframe"),i.src=f,i.addEventListener("load",function(b){k=new a(i.contentWindow,function(){k.listen("submit",n),k.listen("cancel",o),k.listen("close",e.close),window.addEventListener("beforeunload",e.close,!1);for(var a in m)m.hasOwnProperty(a)&&e.listen(a,m[a]);while(j.length>0){var b=j.pop();e.send(b.type,b.data)}h=!0,setTimeout(function(){e.focus()},0),e.dispatch("open")})},!1),g.appendChild(i),setTimeout(function(){i.className+=" fade-in"},10)},this.send=function(a,b){k?k.send(a,b):j.push({type:a,data:b})},this.focus=function(){i.contentWindow.focus()},Object.defineProperties(this,{iframe:{enumerable:!0,get:function(){return i}},closed:{enumerable:!0,get:function(){return!h}}})}}),c("dialog/window-dialog",["core/comm","core/eventmanager","dialog/modal"],function(a,b,c){var d=640,e=479,f=300;return function(g){function r(a){h.dispatch(a.type,a.data)}function s(a){h.dispatch(a.type,a.data),h.close()}function t(a){a.data.type==="connectionclosed"&&h.close(),h.dispatch("error",a.data)}function u(){k&&k.closed===!0&&h.close()}g=g||{};if(!g.url)throw new Error("Window dialog requires a url.");var h=this,i=g.url,j,k,l,m,n=[],o=!1,p=["width="+(g.width||d),"height="+(g.height||e),"toolbar=no","menubar=no","titlebar=yes","location=no","resizable=yes"],q=g.events||{};b(h),h.modal=g.modal,this.close=function(){h.send("close"),setTimeout(function(){l&&(l.destroy(),l=undefined),j.unlisten("submit",r),j.unlisten("cancel",s),j.unlisten("close",h.close),j.destroy(),k.close&&k.close(),clearInterval(m),window.removeEventListener("beforeunload",h.close,!1),j=k=undefined,o=!1;for(var a in q)q.hasOwnProperty(a)&&h.unlisten(a,q[a]);h.dispatch("close")},0)},this.open=function(b){h.modal&&(l=new c(h.modal));for(var d in b)b.hasOwnProperty(d)&&(q[d]=b[d]);k=window.open(i,"dialog-window:"+i,p.join(",")),window.addEventListener("beforeunload",h.close,!1),j=new a(k,function(){j.listen("error",t),j.listen("submit",r),j.listen("cancel",s),j.listen("close",h.close);for(var a in q)q.hasOwnProperty(a)&&h.listen(a,q[a]);m=setInterval(u,f);while(n.length>0){var b=n.pop();h.send(b.type,b.data)}o=!0,h.dispatch("open")})},this.focus=function(){k.focus()},this.send=function(a,b){j?j.send(a,b):n.push({type:a,data:b})},Object.defineProperties(this,{closed:{enumerable:!0,get:function(){return!o}}})}}),c("editor/editor",["core/eventmanager","dialog/iframe-dialog","dialog/window-dialog","util/time"],function(a,b,c,d){function g(d,g,h,i,j,k){function t(){if(q===d.currentMedia.target)d.currentMedia.view.blink();else{var a=d.getTargetByType("elementID",q);a&&a.view.blink()}}function u(a){var b=r.popcornOptions;b.target!==q&&(q=b.target,t()),o.send("trackeventupdated",r.popcornOptions)}function v(a){o.send("trackeventupdatefailed",a.data)}function w(){o=null,r.unlisten("trackeventupdated",u),r.unlisten("trackeventupdatefailed",v),s.dispatch("close")}k=k||{};var l=i||f,m=h,n=e.slice(),o,p={type:l,modal:"behind-timeline",url:g,parent:j},q,r,s=this;a(s),n[0]=k.width||n[0],n[1]=k.height||n[1],this.open=function(a){o||(l==="window"?o=new c(p):o=new b(p));if(!o.closed&&o.focus){o.focus();return}r=a,o.open({open:function(b){var c=[],e={name:d.currentMedia.name,target:d.currentMedia.target};for(var f=0,g=d.targets.length;f<g;f++)c.push(d.targets[f].element.id);var h=a.popcornOptions;o.send("trackeventdata",{manifest:Popcorn.manifest[a.type],popcornOptions:h,targets:c,media:e}),q=h.target,t(),a.listen("trackeventupdated",u),a.listen("trackeventupdatefailed",v),s.dispatch("open")},submit:function(b){var c=b.data.eventData,d=b.data.alsoClose;c&&(a.update(c),d&&o.close())},close:function(a){w()}})},this.close=function(){r&&o&&o.close()},Object.defineProperties(s,{isOpen:{enumerable:!0,get:function(){return!!o}},type:{enumerable:!0,get:function(){return m}},frame:{enumerable:!0,get:function(){return l}},size:{enumerable:!0,get:function(){return{width:n[0],height:n[1]}},set:function(a){a=a||{},n[0]=a.width||n[0],n[1]=a.height||n[1]}}})}var e=[400,400],f="iframe";return g}),c("timeline/track-container",["core/logger","util/dragndrop"],function(a,b){return function(a,c){function l(){h.style.width=d.duration*e+"px"}function m(a){var b=a.data.view;h.appendChild(b.element),b.duration=d.duration,b.zoom=e,b.parent=f,j&&j.update()}var d=c,e=1,f=this,g=document.createElement("div"),h=document.createElement("div"),i,j,k;g.appendChild(h),g.className="tracks-container-wrapper",h.className="tracks-container",h.addEventListener("mousedown",function(a){f.deselectOthers()},!1),k=b.droppable(g,{drop:function(b,c){if(b.getAttribute("data-butter-draggable-type")==="plugin"){var d=a.currentMedia.addTrack(),e=d.view.element.getBoundingClientRect(),f=c[0]-e.left,g=f/e.width*d.view.duration;d.view.dispatch("plugindropped",{start:g,track:d,type:b.getAttribute("data-butter-plugin-type")})}}}),this.setScrollbars=function(a,b){i=a,j=b,j.update()},this.orderTracks=function(a){for(var b=0,c=a.length;b<c;++b){var d=a[b].view.element;d!==h.childNodes[b]&&(a[b].order=b,h.insertBefore(d,h.childNodes[b+1]))}},this.deselectOthers=function(){for(var b=0;b<a.selectedEvents.length;b++)a.selectedEvents[b].selected=!1;return a.selectedEvents=[],f},d.listen("mediaready",function(){l();var a=d.tracks;for(var b=0,c=a.length;b<c;++b){var g=a[b].view;h.appendChild(g.element),g.duration=d.duration,g.zoom=e,g.parent=f}}),a.listen("mediaremoved",function(a){a.data===d&&k&&k.destroy()});var n=d.tracks;for(var o=0;o<n.length;++o)m({data:n[o]});d.listen("trackadded",m),d.listen("trackremoved",function(a){var b=a.data.view;h.removeChild(b.element),j&&j.update()}),f.update=function(){l()},f.snapTo=function(a){var b=a/d.duration,c=h.clientWidth*b,e=h.clientWidth-g.clientWidth;if(c<g.scrollLeft||c>g.scrollLeft+g.clientWidth){if(c>e){g.scrollLeft=e;return}g.scrollLeft=c}},Object.defineProperties(this,{zoom:{enumerable:!0,get:function(){return e},set:function(a){e=a,l();var b=d.tracks;for(var c=0,f=b.length;c<f;++c)b[c].view.zoom=e}},element:{enumerable:!0,get:function(){return g}},container:{enumerable:!0,get:function(){return h}}})}}),c("timeline/scrollbars",["core/eventmanager"],function(a){function c(c,d){function o(){k=g.getBoundingClientRect().height,j=e.getBoundingClientRect().height,l=j-(h.scrollHeight-k)/b,l=Math.max(20,Math.min(j,l)),f.style.height=l+"px",s()}function p(){window.removeEventListener("mouseup",p,!1),window.removeEventListener("mousemove",q,!1),f.addEventListener("mousedown",r,!1)}function q(a){var b=a.pageY-m;b=Math.max(0,Math.min(b,j-l)),f.style.top=b+"px";var c=f.offsetTop/(j-l);g.scrollTop=(h.scrollHeight-k)*c,n.dispatch("scroll",g.scrollTop)}function r(a){if(a.button===0){var b=f.offsetTop;m=a.pageY-b,window.addEventListener("mouseup",p,!1),window.addEventListener("mousemove",q,!1),f.removeEventListener("mousedown",r,!1)}}function s(){h.scrollHeight-j>0?f.style.top=(j-l)*(g.scrollTop/(h.scrollHeight-k))+"px":f.style.top="0px"}var e=document.createElement("div"),f=document.createElement("div"),g=c.element,h=c.container,i=d||g,j,k,l,m=0,n=this;a(n),e.className="scroll-bar scroll-bar-v",f.className="scroll-handle",e.appendChild(f),this.update=function(){o()},g.addEventListener("scroll",function(a){s()},!1),i.addEventListener("mousewheel",function(a){a.wheelDeltaY&&(g.scrollTop-=a.wheelDeltaY,s(),a.preventDefault())},!1),i.addEventListener("DOMMouseScroll",function(a){a.axis===a.VERTICAL_AXIS&&!a.shiftKey&&(g.scrollTop+=a.detail*2,s(),a.preventDefault())},!1),e.addEventListener("click",function(a){if(a.srcElement===f||a.button>0)return;var b=a.pageY,c=f.getBoundingClientRect(),d=e.getBoundingClientRect(),i;b>c.bottom?f.style.top=b-d.top-l+"px":b<c.top&&(f.style.top=b-d.top+"px"),i=f.offsetTop/(j-l),g.scrollTop=(h.scrollHeight-j)*i},!1),window.addEventListener("resize",o,!1),f.addEventListener("mousedown",r,!1),o(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return e}}})}function d(b,c){function p(){j=f.getBoundingClientRect().width,k=g.getBoundingClientRect().width,i=d.getBoundingClientRect().width,l=g.scrollWidth,m=i-(l-j),m=Math.max(20,Math.min(i,m)),e.style.width=m+"px",t()}function q(){window.removeEventListener("mouseup",q,!1),window.removeEventListener("mousemove",r,!1),e.addEventListener("mousedown",s,!1)}function r(a){var b=a.pageX-n;b=Math.max(0,Math.min(b,i-m)),e.style.left=b+"px";var c=e.offsetLeft/(i-m);f.scrollLeft=(l-i)*c,o.dispatch("scroll",f.scrollLeft)}function s(a){if(a.button===0){var b=e.offsetLeft;n=a.pageX-b,window.addEventListener("mouseup",q,!1),window.addEventListener("mousemove",r,!1),e.removeEventListener("mousedown",s,!1)}}function t(){l-i>0?e.style.left=(i-m)*(f.scrollLeft/(l-i))+"px":e.style.left="0px"}var d=document.createElement("div"),e=document.createElement("div"),f=b.element,g=b.container,h=c||g,i,j,k,l,m,n=0,o=this;a(o),d.className="scroll-bar scroll-bar-h",e.className="scroll-handle",d.appendChild(e),f.addEventListener("scroll",function(a){t()},!1),h.addEventListener("mousewheel",function(a){a.wheelDeltaX&&(f.scrollLeft-=a.wheelDeltaX,t(),a.preventDefault())},!1),h.addEventListener("DOMMouseScroll",function(a){if(a.axis===a.HORIZONTAL_AXIS||a.axis===a.VERTICAL_AXIS&&a.shiftKey)f.scrollLeft+=a.detail*2,t(),a.preventDefault()},!1),d.addEventListener("click",function(a){if(a.srcElement===e||a.button>0)return;var b=a.pageX,c=e.getBoundingClientRect(),g=d.getBoundingClientRect(),h;b>c.right?e.style.left=b-g.left-m+"px":b<c.left&&(e.style.left=b-g.left+"px"),h=e.offsetLeft/(i-m),f.scrollLeft=(l-i)*h},!1),window.addEventListener("resize",p,!1),e.addEventListener("mousedown",s,!1),this.update=function(){p()},p(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return d}}})}var b=3;return{Vertical:c,Horizontal:d}}),c("timeline/scrubber",[],function(){var a=50,b=16,c=20,d=3;return function(e,f,g,h,i){function D(){var a=q.duration,b=q.currentTime,c=n.element,d=c.scrollLeft;if(z!==b||A!==d||B!==t){var e=b/a*o,f=e-d;e<d||e-C>j.clientWidth+d?k.style.display="none":(k.style.left=f+"px",k.style.display="block"),e<d?m.style.display="none":(e>w+d?m.style.width=w-2+"px":m.style.width=f+"px",m.style.display="block")}z=b,A=d,B=t}function E(a){x&&(q.play(),y=!1),clearInterval(u),u=-1,window.removeEventListener("mouseup",E,!1),window.removeEventListener("mousemove",H,!1)}function F(a){a==="right"?u=setInterval(function(){s<v.right-d?(clearInterval(u),u=-1):(s+=c,n.element.scrollLeft+=c,G(),D())},b):u=setInterval(function(){s>v.left+d?(clearInterval(u),u=-1):(s-=c,n.element.scrollLeft-=c,G(),D())},b)}function G(){var a=s-r;a=Math.max(0,Math.min(a,w)),q.currentTime=(a+n.element.scrollLeft)/o*q.duration}function H(a){s=a.pageX,u===-1&&(s>v.right-d?F("right"):s<v.left+d&&F("left")),G(),D()}function I(a){r=a.pageX-k.offsetLeft,x&&(q.pause(),y=!0),k.removeEventListener("mousedown",I,!1),window.addEventListener("mousemove",H,!1),window.addEventListener("mouseup",E,!1)}function K(){D()}var j=document.createElement("div"),k=document.createElement("div"),l=document.createElement("div"),m=document.createElement("div"),n=h,o,p=f,q=g,r,s,t=1,u=-1,v,w,x=!1,y=!1,z=-1,A=n.element.scrollLeft,B=-1,C=0;j.className="time-bar-scrubber-container",k.className="time-bar-scrubber-node",l.className="time-bar-scrubber-line",k.title=l.title="Displays the media's current time. Drag to seek through the media.",m.className="fill-bar",k.appendChild(l),j.appendChild(m),j.appendChild(k),p.appendChild(j),e.ui.registerStateToggleFunctions("timeline",{transitionIn:function(){l.removeAttribute("data-butter-shortened")},transitionOut:function(){l.setAttribute("data-butter-shortened",!0)}}),i.listen("scroll",D);var J=this.onMouseDown=function(a){var b=a.pageX-j.getBoundingClientRect().left;q.currentTime=(b+n.element.scrollLeft)/o*q.duration,D(),I(a)};k.addEventListener("mousedown",I,!1),j.addEventListener("mousedown",J,!1),this.update=function(a,b){t=b||t,w=a,o=n.container.getBoundingClientRect().width,j.style.width=w+"px",v=j.getBoundingClientRect(),C=l.clientWidth,D()},q.listen("mediaplaying",function(a){x=!0}),q.listen("mediapause",function(a){y||(x=!1)});var L=setInterval(K,a);this.destroy=function(){clearInterval(L)}}}),c("timeline/zoombar",[],function(){var a=6;return function(b){function j(){window.removeEventListener("mouseup",j,!1),window.removeEventListener("mousemove",k,!1),d.addEventListener("mousedown",l,!1),b(d.offsetLeft/(e.width-d.clientWidth))}function k(a){var c=a.pageX-f;c=Math.max(0,Math.min(c,h-g)),d.style.left=c+"px",b(d.offsetLeft/(e.width-d.clientWidth))}function l(a){if(a.button===0){var b=d.offsetLeft;f=a.pageX-b,window.addEventListener("mouseup",j,!1),window.addEventListener("mousemove",k,!1),d.removeEventListener("mousedown",l,!1)}}var c=document.createElement("div"),d=document.createElement("div"),e,f,g,h,i=this;c.className="zoom-bar scroll-bar",d.className="scroll-handle",d.title="Change the zoom level of the timeline",c.appendChild(d),d.addEventListener("mousedown",l,!1),this.update=function(){e=c.getBoundingClientRect(),g=e.width/a,d.style.width=g+"px",h=e.width},this.zoom=function(a){i.update(),d.style.left=(e.width-d.clientWidth)*a+"px",b(d.offsetLeft/(e.width-d.clientWidth))},c.addEventListener("click",function(a){if(a.srcElement===d)return;var b=a.pageX,e=d.getBoundingClientRect(),f=c.getBoundingClientRect();b>e.right?d.style.left=b-f.left-g+"px":d.style.left=b-f.left+"px",k(a)},!1),c.addEventListener("resize",function(a){i.update()},!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return c}}})}}),c("timeline/status",[],function(){function a(a,b,c){function h(){g?f.removeAttribute("state"):f.setAttribute("state",!0)}function i(a){e.removeAttribute("mouse-state"),window.removeEventListener("mouseup",i,!1)}var d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=!0;d.className=a,e.className="status-button",e.title=c||"",f.className="status-button-icon",d.appendChild(e),e.appendChild(f),e.addEventListener("mousedown",function(a){e.setAttribute("mouse-state","depressed"),window.addEventListener("mouseup",i,!1)},!1),e.addEventListener("click",b,!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return d}},state:{enumerable:!0,get:function(){return g},set:function(a){g=a,h()}}})}function b(a){function f(a,b){if(typeof a=="string"||!isNaN(a)){if(b)try{d.currentTime=Popcorn.util.toSeconds(a)}catch(f){a=d.currentTime}var g=new Date(1970,0,1),h;g.setSeconds(a),h=g.toTimeString().substr(0,8),h>86399&&(h=Math.floor((g-Date.parse("1/1/70"))/36e5)+h.substr(2)),c.value=h}else c.value=e}var b=document.createElement("div"),c=document.createElement("input"),d=a,e=0;b.className="time-container",b.appendChild(c),c.type="text",d.listen("mediatimeupdate",function(a){f(d.currentTime,!1)}),c.addEventListener("focus",function(a){e=c.value},!1),c.addEventListener("blur",function(a){c.value!==e&&f(c.value,!0)},!1),c.addEventListener("keydown",function(a){a.which===13?c.blur():a.which===27&&(c.value=e,c.blur())},!1),f(0,!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return b}}})}return function(c){var d=c,e=document.createElement("div"),f,g,h,i=this;e.className="status-container",h=new b(d),f=new a("mute-button-container",function(a){d.muted=!d.muted},"Toggle volume on/off"),g=new a("play-button-container",function(a){d.ended?d.paused=!1:d.paused=!d.paused},"Play/Pause media"),d.listen("mediamuted",function(a){f.state=!1}),d.listen("mediaunmuted",function(a){f.state=!0}),d.listen("mediavolumechange",function(a){f.state=!d.muted}),d.listen("mediaended",function(a){g.state=!0}),d.listen("mediaplaying",function(a){g.state=!1}),d.listen("mediapause",function(a){g.state=!0}),e.appendChild(h.element),e.appendChild(g.element),i.update=function(){},i.destroy=function(){},Object.defineProperties(this,{statusElement:{enumerable:!0,get:function(){return e}},muteElement:{enumerable:!0,get:function(){return f.element}}})}}),c("timeline/trackhandles",["dialog/iframe-dialog","util/dragndrop"],function(a,b){var c=37;return function(d,e,f,g){function p(b){var f=b.data,g=f.id,h=f.name,i=document.createElement("div"),n=document.createElement("div"),p=document.createElement("div");n.className="menu",p.className="delete",n.appendChild(p),p.addEventListener("click",function(b){var c=new a({type:"iframe",modal:!0,url:d.ui.dialogDir+"delete-track.html",events:{open:function(a){c.send("trackdata",h)},submit:function(a){a.data===!0&&e.removeTrack(f),c.close()},cancel:function(a){c.close()},trackupdated:function(a){c.send("trackupdated",{success:!1})}}});c.trackupdated=function(a){console.log("called",a)},c.open()},!1),i.addEventListener("dblclick",function(b){var c=new a({type:"iframe",modal:!0,url:d.ui.dialogDir+"track-data.html",events:{open:function(a){c.send("trackdata",f.json)},submit:function(a){try{var b=JSON.parse(a.data),d=f.trackEvents,e=b.trackEvents,g={},h=[],j,k;i.childNodes[0].textContent=f.name=b.name;for(j=0,k=e.length;j<k;j++){var l=e[j],m=f.getTrackEventById(l.id);m?(m.update(l.popcornOptions),g[l.id]=l):h.push({type:l.type,popcornOptions:l.popcornOptions})}for(j=d.length,k=0;j>=k;j--)d[j]&&!g[d[j].id]&&f.removeTrackEvent(d[j]);for(j=0,k=h.length;j<k;j++)f.addTrackEvent(h[j]);c.send("trackupdated",!0)}catch(n){console.log(n),c.send("trackupdated",!1)}}}});c.open()},!1),m.push(n),i.className="track-handle",i.id="track-handle-"+g,i.setAttribute("data-butter-track-id",g),i.appendChild(document.createTextNode(h)),i.appendChild(n),o.addItem(i),j.appendChild(i),l[g]={id:g,track:f,element:i,menu:n},k.style.top=j.offsetHeight-c+"px"}var h=e,i=document.createElement("div"),j=document.createElement("div"),k=document.createElement("button"),l={},m=[],n=this;i.className="track-handle-container",j.className="handle-list",i.appendChild(j),k.id="add-track",k.innerHTML='<span class="icon icon-plus-sign"></span> Track',k.classList.add("butter-btn"),k.title="Add a new Track for your events",i.appendChild(k),k.addEventListener("click",function(a){d.currentMedia.addTrack()},!1);var o=b.sortable(j,{change:function(a){var b=[];for(var c=0,d=a.length;c<d;++c){var e=a[c].getAttribute("data-butter-track-id");b.push(l[e].track)}g(b)}}),q=h.tracks;for(var r=0;r<q.length;++r)p({data:q[r]});h.listen("trackadded",p),h.listen("trackremoved",function(a){var b=a.data.id;j.removeChild(l[b].element),o.removeItem(l[b].element),m.splice(m.indexOf(l[b].menu),1),delete l[b],k.style.top=j.offsetHeight-c+"px"}),f.element.addEventListener("scroll",function(a){i.scrollTop=f.element.scrollTop},!1),this.update=function(){i.scrollTop=f.element.scrollTop,k.style.top=j.offsetHeight-c+"px"},n.update(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return i}}})}}),c("util/scrollbars",["core/eventmanager"],function(a){function c(c,d){function n(){h=c.getBoundingClientRect().height,i=d.getBoundingClientRect().height,g=e.getBoundingClientRect().height,j=c.scrollHeight,k=g-(j-h)/b,k=Math.max(20,Math.min(g,k)),f.style.height=k+"px",r()}function o(){window.removeEventListener("mouseup",o,!1),window.removeEventListener("mousemove",p,!1),f.addEventListener("mousedown",q,!1)}function p(a){var b=a.pageY-l,d=g-k;b=Math.max(0,Math.min(b,d));var e=b/d;f.style.top=b+"px",c.scrollTop=(j-h)*e,m.dispatch("scroll",c.scrollTop)}function q(a){if(a.button===0){var b=f.offsetTop;l=a.pageY-b,window.addEventListener("mouseup",o,!1),window.addEventListener("mousemove",p,!1),f.removeEventListener("mousedown",q,!1)}}function r(){d.scrollHeight-g>0?f.style.top=(g-k)*(c.scrollTop/(c.scrollHeight-g))+"px":f.style.top="0px"}var e=document.createElement("div"),f=document.createElement("div"),g,h,i,j,k,l=0,m=this;a(m),e.className="scroll-bar scroll-bar-v",f.className="scroll-handle",e.appendChild(f),this.update=function(){n()},d.addEventListener("scroll",function(a){r()},!1),d.addEventListener("mousewheel",function(a){a.wheelDeltaY&&(c.scrollTop-=a.wheelDeltaY,r(),a.preventDefault())},!1),d.addEventListener("DOMMouseScroll",function(a){a.axis===a.VERTICAL_AXIS&&!a.shiftKey&&(d.scrollTop+=a.detail*2,r(),a.preventDefault())},!1),e.addEventListener("click",function(a){if(a.srcElement===f||a.button>0)return;var b=a.pageY,c=f.getBoundingClientRect(),h=e.getBoundingClientRect(),i;b>c.bottom?f.style.top=b-h.top-k+"px":b<c.top&&(f.style.top=b-h.top+"px"),i=f.offsetTop/(g-k),d.scrollTop=(j-g)*i},!1),window.addEventListener("resize",n,!1),f.addEventListener("mousedown",q,!1),n(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return e}}})}function d(b,c){function m(){g=b.getBoundingClientRect().width,h=c.getBoundingClientRect().width,f=d.getBoundingClientRect().width,i=c.scrollWidth,j=f-(i-g),j=Math.max(20,Math.min(f,j)),e.style.width=j+"px",q()}function n(){window.removeEventListener("mouseup",n,!1),window.removeEventListener("mousemove",o,!1),e.addEventListener("mousedown",p,!1)}function o(a){var b=a.pageX-k;b=Math.max(0,Math.min(b,f-j)),e.style.left=b+"px";var d=e.offsetLeft/(f-j);c.scrollLeft=(i-f)*d,l.dispatch("scroll",c.scrollLeft)}function p(a){if(a.button===0){var b=e.offsetLeft;k=a.pageX-b,window.addEventListener("mouseup",n,!1),window.addEventListener("mousemove",o,!1),e.removeEventListener("mousedown",p,!1)}}function q(){i-f>0?e.style.left=(f-j)*(c.scrollLeft/(i-f))+"px":e.style.left="0px"}var d=document.createElement("div"),e=document.createElement("div"),f,g,h,i,j,k=0,l=this;a(l),d.className="scroll-bar scroll-bar-h",e.className="scroll-handle",d.appendChild(e),c.addEventListener("scroll",function(a){q()},!1),c.addEventListener("mousewheel",function(a){a.wheelDeltaX&&(c.scrollLeft-=a.wheelDeltaX,q(),a.preventDefault())},!1),c.addEventListener("DOMMouseScroll",function(a){if(a.axis===a.HORIZONTAL_AXIS||a.axis===a.VERTICAL_AXIS&&a.shiftKey)c.scrollLeft+=a.detail*2,q(),a.preventDefault()},!1),d.addEventListener("click",function(a){if(a.srcElement===e||a.button>0)return;var b=a.pageX,g=e.getBoundingClientRect(),h=d.getBoundingClientRect(),k;b>g.right?e.style.left=b-h.left-j+"px":b<g.left&&(e.style.left=b-h.left+"px"),k=e.offsetLeft/(f-j),c.scrollLeft=(i-f)*k},!1),window.addEventListener("resize",m,!1),e.addEventListener("mousedown",p,!1),this.update=function(){m()},m(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return d}}})}var b=3;return{Vertical:c,Horizontal:d}}),c("plugin/plugin-list",["util/dragndrop"],function(a){return function(b){var c=document.createElement("div"),d=document.createElement("div");c.id="plugin-list",d.className="container",c.appendChild(d),b.ui.areas.work.addComponent(c,{states:["add-popcorn"],transitionIn:function(){c.style.display="block",setTimeout(function(){c.style.opacity="1"},0)},transitionOut:function(){c.style.opacity="0"},transitionInComplete:function(){},transitionOutComplete:function(){c.style.display="none"}}),b.listen("pluginadded",function(c){var e=document.createElement("div"),f=c.data.helper,g=document.createElement("span"),h=document.createElement("span");a.helper(e,{start:function(){var a=b.targets,c=b.currentMedia;c.view.blink();for(var d=0,e=a.length;d<e;++d)a[d].view.blink()},stop:function(){}}),f&&(g.style.backgroundImage="url('"+f.src+"')",g.className="icon",e.appendChild(g)),h.className="label",h.innerHTML=c.data.type,e.appendChild(h),e.setAttribute("data-butter-plugin-type",c.data.type),e.setAttribute("data-butter-draggable-type","plugin"),d.appendChild(e)}),c.style.display="none",c.classList.add("fadable")}}),c("dependencies",[],function(){var a={"popcorn-js":"../external/popcorn-js",css:"css"},b=/\{([\w\-\._]+)\}/,c=10,d=function(){var a=0;return function(){return a++>0}};return function(e){function g(c){var d,e;while(b.test(c))d=b.exec(c),e=f[d[1]]||a[d[1]]||"",c=c.replace(d[0],e);return c.replace("//","/")}function i(a,b){var c=0;return function(){++c,c===a.length&&b&&b()}}function j(a,b){function d(){c===a.length?b():k.load(a[c++],d)}var c=0;return d}var f=e.value("dirs"),h={js:function(a,b,c,e){e=e||d(),a=g(a);if(!e()){var f=document.createElement("script");f.src=a,f.type="text/javascript",document.head.appendChild(f),f.onload=f.onreadystatechange=c}else c&&c()},css:function(a,b,d,e,f){function j(){i=setInterval(function(){e()&&(clearInterval(i),d&&d())},c)}var h,i;e=e||function(){return!!h},a=g(a),e()?d&&d():(h=document.createElement("link"),h.rel="stylesheet",h.onload=j,h.onerror=f,h.href=a,document.head.appendChild(h))}},k={load:function(a,b,c,d){if(a instanceof Array&&a.length>0){var e=i(a,b);if(!d)for(var f=0;f<a.length;++f)k.load(a[f],e);else{var g=j(a,b);g()}}else{var l=a;if(!h[l.type])throw new Error("Loader type "+l.type+" not found! Attempted: "+l.url);if(!l.url)throw new Error("Attempted to load resource without url.");h[l.type](l.url,l.exclude,b,l.check,c)}}};return k}}),c("ui/toggler",[],function(){return function(a,b){var c=a,d=b,e=document.createElement("div"),f=document.createElement("div"),g=this;e.id="toggle-button",e.title="Show/Hide Timeline",e.appendChild(f),d.appendChild(e),e.addEventListener("click",function(a){c.ui.visible=!c.ui.visible},!1),Object.defineProperties(g,{visible:{enumerable:!0,get:function(){return e.style.display!=="none"},set:function(a){e.style.display=a?"block":"none"}}})}}),c("ui/context-button",[],function(){return function(a){var b=document.createElement("butter-button");b.id="add-popcorn",b.title="Add Popcorn Events to the timeline",b.classList.add("butter-btn"),b.innerHTML='<span class="icon icon-plus-sign"></span> Popcorn',b.addEventListener("click",function(){a.ui.contentState==="timeline"?(a.ui.setContentState("add-popcorn"),a.ui.contentStateLocked=!0):(a.ui.contentStateLocked=!1,a.ui.setContentState("timeline"))},!1),a.ui.areas.tools.addComponent(b,{states:["add-popcorn","editor"],transitionIn:function(){b.setAttribute("disabled",!0),b.innerHTML="Done",b.title="Finish adding Popcorn Events",b.classList.add("add-popcorn-done")},transitionInComplete:function(){b.removeAttribute("disabled")},transitionOut:function(){b.setAttribute("disabled",!0),b.innerHTML='<span class="icon icon-plus-sign"></span> Popcorn',b.title="Add Popcorn Events to the timeline",b.classList.remove("add-popcorn-done")},transitionOutComplete:function(){b.removeAttribute("disabled")}})}}),function(){function a(a){var b=[];if(!a)return null;for(var c in a)a.hasOwnProperty(c)&&(b[b.length]=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&").replace("/%20/g","+")}c("util/xhr",[],function(){function b(){var a=document.getElementById("csrf_token_id");a&&(c=a.value)}var c;document.readyState!=="loading"?b():document.addEventListener("DOMContentLoaded",b,!1);var d={get:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=b,c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.send(null)},post:function(b,d,e,f){var g=new XMLHttpRequest;g.open("POST",b,!0),g.onreadystatechange=e,g.setRequestHeader("X-Requested-With","XMLHttpRequest"),c&&g.setRequestHeader("X-CSRFToken",c),f?(g.setRequestHeader("Content-Type",f),g.send(d)):(g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(a(d)))}};return d})}(),c("cornfield/module",["util/xhr"],function(a){function b(){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}var c=function(c,d){var e=!1,f="",g="",h="",i=b();if(!navigator.id){var j=document.createElement("script");j.src="https://browserid.org/include.js",j.type="text/javascript",j.setAttribute("data-butter-exclude",!0),document.head.appendChild(j)}this.login=function(b){navigator.id.get(function(d){d?a.post(i+"/browserid/verify",{audience:i,assertion:d},function(){if(this.readyState===4)try{var a=JSON.parse(this.response);if(a.status==="okay"){c.cornfield.whoami(function(a){b(a)});return}b(a)}catch(d){b({error:"an unknown error occured"})}}):b(undefined)})},this.whoami=function(b){a.get(i+"/api/whoami",function(){if(this.readyState===4){var a;try{a=JSON.parse(this.response),this.status===200&&(e=!0,f=a.email,h=a.username,g=a.name)}catch(c){a={error:"failed to parse data from server: \n"+this.response}}b&&b(a)}})},c.listen("ready",function k(){c.unlisten("ready",k),c.cornfield.whoami(function(a){a.error||c.dispatch("autologinsucceeded",a)})}),this.email=function(){return f},this.name=function(){return g},this.username=function(){return h},this.authenticated=function(){return e},this.publish=function(b,c){a.post(i+"/api/publish/"+b,null,function(){if(this.readyState===4)try{var a=JSON.parse(this.response);c(a)}catch(b){c({error:"an unknown error occured"})}})},this.logout=function(b){a.get(i+"/browserid/logout",function(){f="";if(this.readyState===4){var a;try{a=JSON.parse(this.response),e=!1,f="",h="",g=""}catch(c){a={error:"an unknown error occured"}}b&&b(a)}})},this.list=function(b){a.get(i+"/api/projects",function(){if(this.readyState===4)try{var a=JSON.parse(this.response);b(a)}catch(c){b({error:"an unknown error occured"})}})},this.load=function(b,c){a.get(i+"/api/project/"+b,function(){if(this.readyState===4)try{var a=JSON.parse(this.response);c(a)}catch(b){c({error:"an unknown error occured"})}})},this.save=function(b,c,d){var e=i+"/api/project/";b&&(e+=b),a.post(e,c,function(){if(this.readyState===4)try{var a=JSON.parse(this.response);d(a)}catch(b){d({error:"an unknown error occured"})}},"application/json")}};return c.__moduleName="cornfield",c}),c("util/lang",[],function(){if("Range"in window&&!Range.prototype.createContextualFragment){var a={getDocument:function(b){if(b.nodeType===9)return b;if(typeof b.ownerDocument!="undefined")return b.ownerDocument;if(typeof b.document!="undefined")return b.document;if(b.parentNode)return this.getDocument(b.parentNode);throw"No document found for node."},isCharacterDataNode:function(a){var b=a.nodeType;return b===3||b===4||b===8},parentElement:function(a){var b=a.parentNode;return b.nodeType===1?b:null},isHtmlNamespace:function(a){var b;return typeof a.namespaceURI=="undefined"||(b=a.namespaceURI)===null||b==="http://www.w3.org/1999/xhtml"},fragmentFromNodeChildren:function(a){var b=this.getDocument(a).createDocumentFragment(),c;while(!!(c=a.firstChild))b.appendChild(c);return b}};Range.prototype.createContextualFragment=function(b){var c=this.startContainer,d=a.getDocument(c);if(!c)throw new DOMException("INVALID_STATE_ERR");var e=null;return c.nodeType===1?e=c:a.isCharacterDataNode(c)&&(e=a.parentElement(c)),e===null||e.nodeName==="HTML"&&a.isHtmlNamespace(a.getDocument(e).documentElement)&&a.isHtmlNamespace(e)?e=d.createElement("body"):e=e.cloneNode(!1),e.innerHTML=b,a.fragmentFromNodeChildren(e)}}return typeof document!="undefined"&&!("classList"in document.createElement("a"))&&function(a){var b="classList",c="prototype",d=(a.HTMLElement||a.Element)[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){var b=0,c=this.length;for(;b<c;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(b==="")throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){var b=f.call(a.className),c=b?b.split(/\s+/):[],d=0,e=c.length;for(;d<e;d++)this.push(c[d]);this._updateClassName=function(){a.className=this.toString()}},k=j[c]=[],l=function(){return new j(this)};h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",i(this,a)!==-1},k.add=function(a){a+="",i(this,a)===-1&&(this.push(a),this._updateClassName())},k.remove=function(a){a+="";var b=i(this,a);b!==-1&&(this.splice(b,1),this._updateClassName())},k.toggle=function(a){a+="",i(this,a)===-1?this.add(a):this.remove(a)},k.toString=function(){return this.join(" ")};if(e.defineProperty){var m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(n){n.number===-2146823252&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}(self),{extend:function(a){var b=a,c=[].slice.call(arguments,1);c.forEach(function(a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])})},smpteToSeconds:function(a){var b=a.split(":");if(b.length===1)return parseFloat(b[0],10);if(b.length===2)return parseFloat(b[0],10)+parseFloat(b[1]/12,10);if(b.length===3)return parseInt(b[0]*60,10)+parseFloat(b[1],10)+parseFloat(b[2]/12,10);if(b.length===4)return parseInt(b[0]*3600,10)+parseInt(b[1]*60,10)+parseFloat(b[2],10)+parseFloat(b[3]/12,10)},secondsToSMPTE:function(a){var b=new Date(1970,0,1),c;return b.setSeconds(a),c=b.toTimeString().substr(0,8),c>86399&&(c=Math.floor((b-Date.parse("1/1/70"))/36e5)+c.substr(2)),c},clone:function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},defaults:function(a,b){for(var c in b)a[c]===undefined&&(a[c]=b[c]);return a},domFragment:function(a){var b=document.createRange(),c;b.selectNode(document.body.firstChild),c=b.createContextualFragment(a);if(c.childNodes.length===1){var d=c.firstChild;return c.removeChild(d),d}return c}}}),c("core/trackevent",["./logger","./eventmanager","util/lang","util/time","./views/trackevent-view"],function(a,b,c,d,e){var f=0,g=function(g){function r(a){return a.default?a.default:a.type==="number"?0:""}g=g||{};var h=this,i="TrackEvent"+f++,j=g.name||i,k=new a(i),l,m=g.type+"",n=g.popcornOptions||{start:0,end:1},o=new e(this,m,n),p=null,q=!1;b(h),h.popcornOptions=n,h.popcornTrackEvent=null,m||k.log("Warning: "+i+" has no type."),n.start=n.start||0,n.start=d.roundTime(n.start),n.end=n.end||n.start+1,n.end=d.roundTime(n.end),this.setPopcornWrapper=function(a){p=a},this.update=function(a,b){a=a||{};var c=!1,e=n.start,f=n.end;isNaN(a.start)||(e=d.roundTime(a.start)),isNaN(a.end)||(f=d.roundTime(a.end));if(e>=f)c="invalidtime";else if(l&&l._media){var g=l._media;if(e>g.duration||f>g.duration||e<0)c="invalidtime"}if(c)h.dispatch("trackeventupdatefailed",c);else{var i=Popcorn.manifest[m]&&Popcorn.manifest[m].options;if(i){for(var j in i)i.hasOwnProperty(j)&&(a[j]===undefined?b&&(n[j]=r(i[j])):n[j]=a[j]);!("target"in i)&&a.target&&(n.target=a.target)}e&&(n.start=e),f&&(n.end=f),o.update(n),h.popcornOptions=n,p&&p.updateEvent(h),h.dispatch("trackeventupdated",h)}},this.moveFrameLeft=function(a,b){b?n.end-n.start>a?n.end-=a:n.end=n.start:n.start>a?(n.start-=a,n.end-=a):(n.end=n.end-n.start,n.start=0),h.dispatch("trackeventupdated",h),o.update(n)},this.moveFrameRight=function(a,b){n.end<l._media.duration-a?(n.end+=a,b||(n.start+=a)):(b||(n.start+=l._media.duration-n.end),n.end=l._media.duration),h.dispatch("trackeventupdated",h),o.update(n)},Object.defineProperties(this,{_track:{enumerable:!0,get:function(){return l},set:function(a){l=a,l&&h.update(n)}},view:{enumerable:!0,configurable:!1,get:function(){return o}},type:{enumerable:!0,get:function(){return m}},name:{enumerable:!0,get:function(){return j}},id:{enumerable:!0,get:function(){return i}},selected:{enumerable:!0,get:function(){return q},set:function(a){a!==q&&(q=a,o.selected=q,q?h.dispatch("trackeventselected"):h.dispatch("trackeventdeselected"))}},json:{enumerable:!0,get:function(){return{id:i,type:m,popcornOptions:c.clone(n),track:l?l.name:undefined,name:j}},set:function(a){m=n.type=a.type,a.name&&(j=a.name),n=a.popcornOptions,h.popcornOptions=n,o.type=m,o.update(n),h.dispatch("trackeventupdated",h)}}})};return g}),c("core/track",["./logger","./eventmanager","./trackevent","./views/track-view"],function(a,b,c,d){var e=0,f=function(f){f=f||{};var g=[],h="Track"+e++,i=f.target,j=new a(h),k=f.name||h,l=f.order||0,m=new d(this),n=null,o=this;o._media=null,b(o),this.setPopcornWrapper=function(a){n=a;for(var b=0,c=g.length;b<c;++b)g[b].setPopcornWrapper(a)},Object.defineProperties(this,{view:{enumerable:!0,configurable:!1,get:function(){return m}},order:{enumerable:!0,get:function(){return l},set:function(a){l=a,o.dispatch("trackorderchanged",l)}},target:{enumerable:!0,get:function(){return i},set:function(a){i=a,o.dispatch("tracktargetchanged",o);for(var b=0,c=g.length;b<c;b++)g[b].target=a,g[b].update({target:a});j.log("target changed: "+a)}},name:{enumerable:!0,get:function(){return k},set:function(a){k=a,o.dispatch("tracknamechanged",o)}},id:{enumerable:!0,configurable:!1,get:function(){return h}},json:{enumerable:!0,get:function(){var a=[];for(var b=0,c=g.length;b<c;++b)a.push(g[b].json);return{name:k,id:h,trackEvents:a}},set:function(a){a.name&&(k=a.name);if(a.trackEvents){var b=a.trackEvents;for(var d=0,e=b.length;d<e;++d){var f=new c;f.json=b[d],o.addTrackEvent(f)}}}},trackEvents:{enumerable:!0,configurable:!1,get:function(){return g}}}),this.getTrackEventById=function(a){for(var b=0,c=g.length;b<c;++b)if(g[b].id===a)return g[b]},this.getTrackEventByName=function(a){for(var b=0,c=g.length;b<c;++b)if(g[b].name===a)return g[b]},this.addTrackEvent=function(a){return a instanceof c||(a=new c(a),a.update(a.popcornOptions,!0)),i&&(a.target=i),a._track=o,g.push(a),a.track=o,o.chain(a,["trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),m.addTrackEvent(a),a.track=o,a.setPopcornWrapper(n),o.dispatch("trackeventadded",a),a},this.removeTrackEvent=function(a){var b=g.indexOf(a);if(b>-1)return g.splice(b,1),o.unchain(a,["trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),m.removeTrackEvent(a),a._track=null,a.setPopcornWrapper(null),o.dispatch("trackeventremoved",a),a},this.deselectEvents=function(a){for(var b=0,c=g.length;b<c;++b)g[b]!==a&&(g[b].selected=!1)}};return f}),function(){c("editor/module",["core/eventmanager","core/trackevent","./editor"],function(a,b,c){function d(d,e){function j(a){h.frame==="iframe"&&d.ui.contentState==="editor"&&d.ui.popContentState("editor"),h.unlisten("close",j),h=null}function k(a){h.frame==="iframe"&&d.ui.contentState!=="editor"&&d.ui.pushContentState("editor")}function l(a){i.edit(a.target.trackEvent)}e=e||{};var f={},g,h,i=this;a(i),d.listen("trackeventcreated",function(a){["target","media"].indexOf(a.data.by)>-1&&d.ui.contentState==="timeline"&&i.edit(a.data.trackEvent)}),this.edit=function(a){if(!a||!(a instanceof b))throw new Error("trackEvent must be valid to start an editor.");var c=a.type;f[c]||(c="default");if(!h){var d=f[c];if(!d)throw new Error("Editor "+c+" not found.");h=d,d.listen("open",k),d.open(a),d.listen("close",j)}},this.add=function(a,b,e){if(!b||!a)throw new Error("Can't create an editor without a plugin type and editor source");var h=f[b]=new c(d,a,b,e,g);return h},this.remove=function(a){if(!a)return;var b=f[a];return f[a]=undefined,b},d.listen("trackeventadded",function(a){a.data.view.listen("trackeventdoubleclicked",l,!1)}),d.listen("trackeventremoved",function(a){a.data.view.unlisten("trackeventdoubleclicked",l,!1)}),this._start=function(a){var b=document.createElement("div");b.id="butter-editor",g=document.createElement("div"),g.id="editor-container",b.appendChild(g),b.classList.add("fadable"),d.ui.areas.work.addComponent(b,{states:["editor"],transitionIn:function(){b.style.display="block",setTimeout(function(){b.style.opacity="1"},0)},transitionInComplete:function(){},transitionOut:function(){h&&h.close(),b.style.opacity="0"},transitionOutComplete:function(){b.style.display="none"}}),b.style.display="none";for(var c in e)e.hasOwnProperty(c)&&i.add(e[c],c);a()},d.listen("trackeventeditrequested",function(a){i.edit(a.target)})}return d.__moduleName="editor",d})}(),c("timeline/timebar",["util/lang","./scrubber"],function(a,b){var c=5;return function(d,e,f,g){function n(b){var d=f.container.getBoundingClientRect().width,e=Math.min(d,l.container.scrollWidth),g=Math.min(e,l.element.offsetWidth-c);j.style.width=g+"px";var h=i.getContext("2d");i.height!==i.offsetHeight&&(i.height=i.offsetHeight),i.width!==g&&(i.width=g);var n=l.element.firstChild.clientWidth/k.duration,o=h.measureText(a.secondsToSMPTE(5)).width,p=20,q=0,r=-((o+p)/2),s=l.element.scrollLeft/n,t=(l.element.scrollLeft+g)/n;h.clearRect(0,0,i.width,i.height),h.translate(-l.element.scrollLeft,0),h.beginPath();for(var u=1,v=k.duration+1;u<v;u++){if(u+1<s)continue;if(u-1>t)break;var w=u*n,x=-~w+~q;x>3&&(x>6&&(h.moveTo(-~w-x/2,0),h.lineTo(-~w-x/2,7),x>12&&(h.moveTo(-~w-x/4*3,0),h.lineTo(-~w-x/4*3,4),h.moveTo(-~w-x/4,0),h.lineTo(-~w-x/4,4))),h.moveTo(-~w,0),h.lineTo(-~w,10),w-r>o+p&&(r=w,h.fillStyle="#999999",h.fillText(a.secondsToSMPTE(u),-~w-o/2,21)),q=w)}h.strokeStyle="#999999",h.stroke(),h.translate(l.element.scrollLeft,0),m.update(g,b)}var h=document.createElement("div"),i=document.createElement("canvas"),j=document.createElement("div"),k=e,l=f,m=new b(d,h,k,l,g);h.className="time-bar",j.className="time-bar-canvas-container",j.appendChild(i),h.appendChild(j),i.addEventListener("mousedown",m.onMouseDown,!1),l.element.addEventListener("scroll",n,!1),window.addEventListener("resize",n,!1),this.update=function(a){n(a)},this.destroy=function(){m.destroy()},Object.defineProperties(this,{element:{enumerable:!0,get:function(){return h}}})}}),c("timeline/media",["core/trackevent","core/track","core/eventmanager","./track-container","./scrollbars","./timebar","./zoombar","./status","./trackhandles","util/lang"],function(a,b,c,d,e,f,g,h,i,j){function m(a,b){function j(a){p.orderTracks(a)}function m(a){var b=k*a+D;b!==E&&(E=b,p.zoom=E,Q())}function F(){p.snapTo(o.currentTime),u.update()}function G(b){b!==o.target?(b=a.getTargetByType("elementID",b),b&&b.view.blink()):o.view.blink()}function H(a){var b=a.trackEvent,c=b.popcornOptions;c.target&&G(c.target)}function I(a){}function J(a){if(C&&B==="click"){var b=C.popcornOptions;b.target&&G(b.target)}}function K(a){C=null}function L(b){var c=b.data.trackEvent,d=b.data.originalEvent;C=c,c.selected=!0;if(!d.shiftKey){var e=o.tracks;for(var f in e)e.hasOwnProperty(f)&&e[f].deselectEvents(c);a.selectedEvents=[c]}else a.selectedEvents.push(c)}function M(){D=r.clientWidth/o.duration,E=l,y.zoom(E),p.zoom=E,Q(),n.dispatch("ready")}function N(){function b(a){var b=a.data;b.view.listen("trackeventdragstarted",K),b.view.listen("trackeventmouseup",J),b.view.listen("trackeventmousedown",L),B==="hover"&&(b.view.listen("trackeventmouseover",H),b.view.listen("trackeventmouseout",I))}function c(a){var c=a.data;c.view.listen("plugindropped",O),c.view.listen("trackeventdropped",P),c.view.listen("trackeventmousedown",L),B==="hover"&&(c.view.listen("trackeventmouseover",H),c.view.listen("trackeventmouseout",I));var d=c.trackEvents;for(var e=0;e<d.length;++e)b({data:d[e]})}o.unlisten("mediaready",N),o.listen("mediaready",M),r.appendChild(p.element),r.appendChild(u.element),r.appendChild(v.element),s.appendChild(x.element),s.appendChild(z.statusElement),s.appendChild(z.muteElement),a.ui.areas.statusbar.element.appendChild(s),q.appendChild(A.element),q.appendChild(y.element),q.appendChild(r),o.listen("trackeventremoved",function(a){var b=a.data;b.view.unlisten("trackeventdragstarted",K),b.view.unlisten("trackeventmouseup",J),b.view.unlisten("trackeventmousedown",L),B==="hover"&&(b.view.unlisten("trackeventmouseover",H),b.view.unlisten("trackeventmouseout",I))});var d=o.tracks;for(var e=0;e<d.length;++e)c({data:d[e]});o.listen("trackadded",c),o.listen("trackeventadded",b),o.listen("trackremoved",function(a){var b=a.data;b.view.unlisten("plugindropped",O),b.view.unlisten("trackeventdropped",P),b.view.listen("trackeventmousedown",L),B==="hover"&&(b.view.listen("trackeventmouseover",H),b.view.listen("trackeventmouseout",I))}),M()}function O(b){var c=b.data.type,d=b.data.track,e=b.data.start;e+1>o.duration&&(e=o.duration-1);var f=a.defaultTarget;!f&&a.targets.length>0&&(f=a.targets[0]),d.addTrackEvent({popcornOptions:{start:e,end:e+1,target:f.elementID},type:c}),f&&f.view.blink()}function P(a){var b=o.findTrackWithTrackEventId(a.data.trackEvent),c=b.trackEvent,d=c.popcornOptions;b.track.removeTrackEvent(c);var e=d.end-d.start;d.start=a.data.start,d.end=d.start+e,c.update(d),a.data.track.addTrackEvent(c)}function Q(){o.duration&&(p.update(),x.update(E),u.update(),v.update(),y.update(),A.update())}var n=this,o=b,p=new d(a,b),q=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),t=[],u=new e.Horizontal(p),v=new e.Vertical(p,q),w=!1,x=new f(a,o,p,u),y=new g(m),z=new h(o),A=new i(a,o,p,j),B=a.config.value("ui").trackEventHighlight||"click",C,D,E;p.setScrollbars(u,v),c(n),q.className="media-instance",q.id="media-instance"+b.id,r.className="media-container",s.className="media-status-container",o.listen("mediaplaying",F),o.listen("mediapause",F),o.listen("trackeventselected",function(a){t.push(a.target)}),o.listen("trackeventdeselected",function(a){t.splice(t.indexOf(a.target),1)}),o.listen("mediaready",N),this.destroy=function(){q.parentNode.removeChild(q),s.parentNode&&a.ui.areas.statusbar.element.removeChild(s),x.destroy()},this.hide=function(){q.style.display="none"},this.show=function(){q.style.display="block"},a.listen("ready",function(){Q()}),p.zoom=E,Object.defineProperties(this,{zoom:{enumerable:!0,get:function(){return E},set:function(a){E=a,Q()}},element:{enumerable:!0,configurable:!1,get:function(){return q}},media:{enumerable:!0,configurable:!1,get:function(){return o}},shrunken:{enumerable:!0,configurable:!1,get:function(){return w},set:function(a){a!==w&&(w=a)}}})}var k=300,l=.5;return m}),c("timeline/module",["core/logger","./media"],function(a,b){var c=function(a,c){var d={},e,f=document.createElement("div");f.id="butter-timeline",f.classList.add("fadable"),this._start=function(b){a.ui.areas.work.addComponent(f,{states:["timeline"],transitionIn:function(){f.style.visibility="visible",setTimeout(function(){f.style.opacity="1"},0)},transitionInComplete:function(){},transitionOut:function(){f.style.opacity="0"},transitionOutComplete:function(){f.style.visibility="hidden"}}),a.ui.registerStateToggleFunctions("timeline",{transitionIn:function(){f.removeAttribute("data-butter-disabled")},transitionOut:function(){f.setAttribute("data-butter-disabled",!0)}}),a.ui.pushContentState("timeline"),b()},a.ui&&a.ui.listen("uivisibilitychanged",function(a){for(var b in d)d.hasOwnProperty(b)&&(d[b].shrunken=!a.data)}),this.findAbsolutePosition=function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return[b,c]},a.listen("mediaadded",function(c){function i(b){e!==d[b.data.id]&&(e&&e.hide(),e=d[b.data.id],e&&e.show(),a.dispatch("timelineready"))}function j(b){var c=b.data;d[c.id]&&d[c.id].destroy(),delete d[c.id],e&&c.id===e.media.id&&(e=undefined),a.unlisten("mediachanged",i),a.unlisten("mediaremoved",j)}var g=c.data,h=new b(a,g);d[g.id]=h,f.appendChild(h.element),a.listen("mediachanged",i),a.listen("mediaremoved",j)}),Object.defineProperties(this,{zoom:{get:function(){return e.zoom},set:function(a){e.zoom=a}}})};return c.__moduleName="timeline",c}),c("plugin/plugin",["util/dragndrop","util/lang"],function(a,b){var c="butter-plugin-";return function(d,e){e=e||{};var f="plugin"+d,g=this,h=e.type,i=e.path,j={},k=e.type,l=document.getElementById(g.type+"-icon")||document.getElementById("default-icon");if(i&&!Popcorn.manifest[k]){var m=document.getElementsByTagName("HEAD")[0],n=document.createElement("script");n.src=i,m.appendChild(n)}Object.defineProperties(this,{id:{enumerable:!0,get:function(){return f}},name:{enumerable:!0,get:function(){return h}},path:{enumerable:!0,get:function(){return i}},manifest:{enumerable:!0,get:function(){return j},set:function(a){j=a}},type:{enumerable:!0,get:function(){return k}},helper:{enumerable:!0,get:function(){return l}}}),l=document.getElementById(g.type+"-icon")||document.getElementById("default-icon"),l&&(l=l.cloneNode(!1)),this.createElement=function(d,e){var f;if(!e)f=document.createElement("span"),f.innerHTML=g.type+" ";else{var h=e.replace(/\$type/g,g.type);f=b.domFragment(h)}return f.id=c+g.type,f.setAttribute("data-butter-plugin-type",g.type),f.setAttribute("data-butter-draggable-type","plugin"),a.helper(f,{image:l,start:function(){var a=d.targets,b=d.currentMedia;b.view.blink();for(var c=0,e=a.length;c<e;++c)a[c].view.blink()},stop:function(){}}),this.element=f,f}}}),function(){c("plugin/module",["core/logger","util/dragndrop","util/scrollbars","./plugin-list","./plugin"],function(a,b,c,d,e){function j(a){var b=0,c=0,d=0,e=a;while(e.length<9)e+=a;b=(e.charCodeAt(0)+e.charCodeAt(3)+e.charCodeAt(6))%(e.charCodeAt(8)*5%360),c=(e.charCodeAt(0)+e.charCodeAt(2)+e.charCodeAt(4)+e.charCodeAt(6))%100*.05+95,d=(e.charCodeAt(1)+e.charCodeAt(3)+e.charCodeAt(5)+e.charCodeAt(7))%100*.2+40;if(b<20||b>340)d+=10;return b>160&&b<200&&(d-=10),{h:b,s:c,l:d}}function k(a){var b="",c=j(a);b+=h+"["+g+'="'+a+'"]{',b+="background: hsl( "+c.h+", "+c.s+"%, "+c.l+"% );",b+="}",i.innerHTML=i.innerHTML+b}var f={},g="data-butter-trackevent-type",h="#butter-timeline .butter-track-event",i=document.createElement("style");i.type="text/css",i.media="screen",i.setAttribute("data-butter-exclude","true");var l=function(a,g){var h=[],j=document.createElement("div"),l=document.createElement("div"),m=document.createElement("div"),n=this,o='<div class="list-item $type_tool">$type</div>';j.id="butter-plugin",m.className="list",l.className="list-wrapper";var p=document.createElement("div");p.className="title",p.innerHTML="<span>My Events</span>",j.appendChild(p),l.appendChild(m),j.appendChild(l);var q=new c.Vertical(l,m);j.appendChild(q.element),this._start=function(b){a.ui&&(document.head.appendChild(i),a.ui.areas.tools.addComponent(j),d(a)),g&&g.plugins?n.add(g.plugins,b):b()},this.add=function(b,c){if(b instanceof Array){var d=0,i=0,j=0,l=function(){++d===b.length&&c&&c()};for(i=0,j=b.length;i<j;i++)n.add(b[i],l)}else{f[b.type]||k(b.type),b=new e(h.length,b);var p=setInterval(function(a){if(!Popcorn.manifest[b.type])return;b.manifest=Popcorn.manifest[b.type],clearInterval(p),c&&c()},100);h.push(b),g.defaults&&g.defaults.indexOf(b.type)>-1&&m.appendChild(b.createElement(a,o)),a.dispatch("pluginadded",b)}return q.update(),b},this.remove=function(b){if(typeof b=="string"){b=this.get(b);if(!b)return}var c,d;for(c=0,d=h.length;c<d;c++)if(h[c].name===b.name){var e=a.tracks;for(c=0,d=e.length;c<d;c++){var f=e[c].trackEvents;for(var g=0,i=f.length-1;i>=g;i--)f[i].type===b.name&&e[c].removeTrackEvent(f[i])}h.splice(c,1),d--,m.removeChild(b.element);var j=document.getElementsByTagName("HEAD")[0];for(c=0,d=j.children.length;c<d;c++)j.children[c].getAttribute("src")===b.path&&j.removeChild(j.children[c]);a.dispatch("pluginremoved",b)}q.update()},this.clear=function(){while(h.length>0){var b=h.pop();m.removeChild(b.element),a.dispatch("pluginremoved",b)}},this.get=function(a){for(var b=0,c=h.length;b<c;++b)if(h[b].name===a)return h[b]},b.droppable(j,{drop:function(b){if(b.getAttribute("data-butter-draggable-type")==="plugin"){var c=b.getAttribute("data-butter-plugin-type"),d=n.get(c);if(d){for(var e=0;e<m.childNodes.length;++e)if(m.childNodes[e].getAttribute("data-butter-plugin-type")===c)return;m.appendChild(d.createElement(a,o))}}}})};return l.__moduleName="plugin",l})}(),c("modules",["editor/module","timeline/module","cornfield/module","plugin/module"],function(){var a=Array.prototype.slice.apply(arguments);return function(b,c,d){var e=[],f=0,g=0;for(var h=0;h<a.length;++h){var i=a[h].__moduleName;b[i]=new a[h](b,c.value(i)),e.push(b[i])}return{load:function(a){function b(){f++,f===e.length&&a()}for(var c=0;c<e.length;++c)e[c]._load?e[c]._load(b):f++;f===e.length&&a()},ready:function(a){function b(){g++,g===e.length&&a()}for(var c=0;c<e.length;++c)e[c]._start?e[c]._start(b):g++}}}}),function(){var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],d=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,e=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,g=f&&location.protocol&&location.protocol.replace(/\:/,""),h=f&&location.hostname,i=f&&(location.port||void 0),j=[];c("text",[],function(){var c,l;return c={version:"1.0.8",strip:function(a){if(a){var a=a.replace(d,""),b=a.match(e);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var b,c,d;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(c=0;c<3;c++){d=a[c];try{b=new ActiveXObject(d)}catch(e){}if(b){a=[d];break}}return b},parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),a=a.substring(c+1,a.length),c=a.indexOf("!");return c!==-1&&(b=a.substring(c+1,a.length),b=b==="strip",a=a.substring(0,c)),{moduleName:d,ext:a,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,d,e){var f=c.xdRegExp.exec(a),g;return f?(a=f[2],f=f[3],f=f.split(":"),g=f[1],f=f[0],(!a||a===b)&&(!f||f===d)&&(!g&&!f||g===e)):!0},finishLoad:function(a,b,d,e,f){d=b?c.strip(d):d,f.isBuild&&(j[a]=d),e(d)},load:function(a,b,d,e){if(e.isBuild&&!e.inlineText)d();else{var j=c.parseName(a),k=j.moduleName+"."+j.ext,l=b.toUrl(k),m=e&&e.text&&e.text.useXhr||c.useXhr;!f||m(l,g,h,i)?c.get(l,function(b){c.finishLoad(a,j.strip,b,d,e)}):b([k],function(a){c.finishLoad(j.moduleName+"."+j.ext,j.strip,a,d,e)})}},write:function(a,b,d){if(j.hasOwnProperty(b)){var e=c.jsEscape(j[b]);d.asModule(a+"!"+b,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,b,d,e,f){var b=c.parseName(b),g=b.moduleName+"."+b.ext,h=d.toUrl(b.moduleName+"."+b.ext)+".js";c.load(g,d,function(){var b=function(a){return e(h,a)};b.asModule=function(a,b){return e.asModule(a,h,b)},c.write(a,g,b,f)},f)}},c.createXhr()?c.get=function(a,b){var d=c.createXhr();d.open("GET",a,!0),d.onreadystatechange=function(){d.readyState===4&&b(d.responseText)},d.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=b.nodeRequire("fs"),c.get=function(a,b){var c=l.readFileSync(a,"utf8");c.indexOf("")===0&&(c=c.substring(1)),b(c)}):typeof Packages!="undefined"&&(c.get=function(a,b){var c=new java.io.File(a),d=java.lang.System.getProperty("line.separator"),c=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(c),"utf-8")),e,f,g="";try{e=new java.lang.StringBuffer,(f=c.readLine())&&f.length()&&f.charAt(0)===65279&&(f=f.substring(1));for(e.append(f);(f=c.readLine())!==null;)e.append(d),e.append(f);g=String(e.toString())}finally{c.close()}b(g)}),c})}(),c("text!default-config.json",[],function(){return'{\n  "name": "default-config",\n  "baseDir": "../",\n  "snapshotHTMLOnReady": true,\n  "scrapePage": true,\n  "title": "Popcorn Maker",\n  "editor": {\n    "default": "{{baseDir}}editors/default-editor.html",\n    "googlemap": "{{baseDir}}editors/googlemap-editor.html"\n  },\n  "ui": {\n    "enabled": true,\n    "trackEventHighlight": "click"\n  },\n  "mediaDefaults": {\n    "frameAnimation": true\n  },\n  "plugin": {\n    "plugins": [\n      {\n        "type": "attribution",\n        "path": "{{baseDir}}external/popcorn-js/plugins/attribution/popcorn.attribution.js"\n      },\n      {\n        "type": "webpage",\n        "path": "{{baseDir}}external/popcorn-js/plugins/webpage/popcorn.webpage.js"\n      },\n      {\n        "type": "text",\n        "path": "{{baseDir}}external/popcorn-js/plugins/text/popcorn.text.js"\n      },\n      {\n        "type": "googlemap",\n        "path": "{{baseDir}}external/popcorn-js/plugins/googlemap/popcorn.googlemap.js"\n      },\n      {\n        "type": "image",\n        "path": "{{baseDir}}external/popcorn-js/plugins/image/popcorn.image.js"\n      },\n      {\n        "type": "twitter",\n        "path": "{{baseDir}}external/popcorn-js/plugins/twitter/popcorn.twitter.js"\n      },\n      {\n        "type": "wikipedia",\n        "path": "{{baseDir}}external/popcorn-js/plugins/wikipedia/popcorn.wikipedia.js"\n      },\n      {\n        "type": "mediaspawner",\n        "path": "{{baseDir}}external/popcorn-js/plugins/mediaspawner/popcorn.mediaspawner.js"\n      }\n    ],\n    "defaults": [\n      "text",\n      "image",\n      "googlemap"\n    ]\n  },\n  "player": {\n    "players": [\n      {\n        "type": "youtube",\n        "path": "{{baseDir}}external/popcorn-js/players/youtube/popcorn.youtube.js"\n      },\n      {\n        "type": "soundcloud",\n        "path": "{{baseDir}}external/popcorn-js/players/soundcloud/popcorn.soundcloud.js"\n      },\n      {\n        "type": "vimeo",\n        "path": "{{baseDir}}external/popcorn-js/players/vimeo/popcorn.vimeo.js"\n      }\n    ],\n    "defaults": [\n      "youtube",\n      "soundcloud",\n      "vimeo"\n    ]\n  },\n  "dirs": {\n    "popcorn-js": "{{baseDir}}external/popcorn-js/",\n    "css": "{{baseDir}}css/",\n    "dialogs": "{{baseDir}}dialogs/",\n    "resources": "{{baseDir}}resources/"\n  },\n  "icons": {\n    "default": "popcorn-icon.png",\n    "image": "image-icon.png"\n  }\n}\n'}),c("text!layouts/ua-warning.html",[],function(){return'<div class="butter-ua-warning" data-butter-exclude>Your web browser may lack some functionality expected by Butter to function properly. Please upgrade your browser or <a href="https://webmademovies.lighthouseapp.com/projects/65733-popcorn-maker">file a bug</a> to find out why your browser isn\'t fully supported. Click <a href="#" class="close-button">here</a> to remove this warning.</div>'}),c("text!layouts/media-view.html",[],function(){return'<div class="butter-media-properties" data-butter-exclude="true">\n  <p class="edit-message">Edit source...</p>\n  <div class="butter-container">\n    <div class="butter-inner-container">\n      <div class="butter-inner-container-title">Video/Audio URL</div>\n      <div class="url-group">\n        <div class="url fade-in"><input type="text" /><button class="remove">-</button></div>\n      </div>\n      <p class="form-field-notes"></p>\n      <button class="save">Save</button><button class="add-url">Add Alternate URL</button>\n      <div class="loading-container"></div>\n    </div>\n  </div>\n</div>'}),c("core/views/media-view",["ui/page-element","ui/logo-spinner","util/lang","ui/widget/textbox","text!layouts/media-view.html"],function(a,b,c,d,e){var f="Supports HTML5 video and YouTube",g=300,h=4;return function(i,j){function A(){n&&!o&&(B(!1),q.classList.remove("open"))}function B(a){a?(n=!1,q.style.width=z.width+"px",q.style.height=z.height+"px"):(q.style.width="",q.style.height="")}function C(a){d(a),a.addEventListener("blur",function(a){o=!1,A()},!1),a.addEventListener("focus",function(a){o=!0},!1)}function D(){var a=s.cloneNode(!0);a.classList.remove("fade-in"),x.appendChild(a),setTimeout(function(){a.classList.add("fade-in")},0),z.width=r.clientWidth,z.height=r.clientHeight,B(!0),a.querySelector("button.remove").addEventListener("click",function(b){E(a)},!1),C(a.querySelector("input[type='text']")),x.querySelectorAll("input[type='text']").length>=h&&(w.style.visibility="hidden")}function E(a){x.removeChild(a),z.width=r.clientWidth,z.height=r.clientHeight,B(!0),x.querySelectorAll("input[type='text']").length<h&&(w.style.visibility="visible")}function F(a,b){a?u.innerHTML=b:u.innerHTML=f}function G(){var a=[],b=r.querySelectorAll("input[type='text']"),c=[];u.classList.add("form-ok"),u.classList.remove("form-error");for(var d=0,e=b.length;d<e;d++)b[d].classList.add("form-ok"),b[d].classList.remove("form-error"),H(b[d].value)?a.push(b[d].value):(u.classList.remove("form-ok"),u.classList.add("form-error"),c.push(b[d]),b[d].classList.remove("form-ok"),b[d].classList.add("form-error"));c.length?F(!0,"URL(s) not valid. Please use http://..."):a.length&&(u.innerHTML="URL changed.",i.url=a)}function H(a){var b=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return a.match(b)}function I(){if(typeof i.url=="string")t.value=i.url;else{if(!i.url.length)throw"Media url is expected value (not string or array): "+i.url;var a=i.url,b=x.querySelectorAll("input[type='text']");while(b.length<a.length)D(),b=x.querySelectorAll("input[type='text']");while(b.length>a.length)E(b[b.length-1]),b=x.querySelectorAll("input[type='text']");for(var c=0;c<a.length;++c)b[c].value=a[c]}}function J(a){var b=a?a.data:l.element.getBoundingClientRect();q.style.left=b.left+"px",q.style.top=b.top+"px"}var k=i,l,m=j.onDropped||function(){},n=!1,o=!1,p,q=c.domFragment(e),r=q.querySelector("div.butter-container"),s=q.querySelector("div.url"),t=q.querySelector("input[type='text']"),u=q.querySelector(".form-field-notes"),v=q.querySelector("button.save"),w=q.querySelector("button.add-url"),x=q.querySelector("div.url-group"),y=q.querySelector(".loading-container"),z;w.addEventListener("click",function(a){D()},!1),C(t),q.addEventListener("mouseover",function(a){a.stopPropagation(),q.classList.add("open"),z||(z={width:r.clientWidth,height:r.clientHeight}),B(!0)},!0),q.addEventListener("mouseout",function(a){setTimeout(function(){A()},g),n=!0},!1),p=b(y),u.innerHTML=f,t.addEventListener("keypress",function(a){a.which===13&&G()},!1),v.addEventListener("click",G,!1),p.start(),v.setAttribute("disabled",!0),i.listen("mediacontentchanged",function(a){I(),F(!1),v.setAttribute("disabled",!0),p.start()}),i.listen("mediafailed",function(a){F(!0,"Media failed to load. Check your URL."),v.removeAttribute("disabled"),t.className+=" form-error",u.className+=" form-error",p.stop()}),i.listen("mediaready",function(a){F(!1),v.removeAttribute("disabled"),p.stop()}),this.blink=function(){l.blink()},this.destroy=function(){l.destroy(),l=null},this.update=function(){I();var b=document.getElementById(k.target);l&&l.destroy(),l=new a(k.target,{drop:function(a){m(a)}},{highlightClass:"butter-media-highlight"}),b&&(q.parentNode||document.body.appendChild(q),l.listen("moved",J),J())}}}),function(){c("core/media",["core/logger","core/eventmanager","core/track","core/popcorn-wrapper","core/views/media-view"],function(a,b,c,d,e){var f=500,g=10,h=0,i=function(i){function y(a){w.dispatch("trackeventrequested",a)}function z(a){var b=a.data;x.updateEvent(b),b._popcornWrapper=x}function A(a){var b=a.data;x.destroyEvent(b),b._popcornWrapper=null}function B(){n&&p&&x.prepare(n,p,t,w.popcornCallbacks,w.popcornScripts),v&&v.update()}i=i||{},b(this);var j=[],k="Media"+h++,l=new a(k),m=i.name||k,n=i.url,o=!1,p=i.target,q,r=0,s=0,t=i.popcornOptions,u,v,w=this,x=new d(k,{popcornEvents:{muted:function(){w.dispatch("mediamuted",w)},unmuted:function(){w.dispatch("mediaunmuted",w)},volumechange:function(){w.dispatch("mediavolumechange",x.volume)},timeupdate:function(){r=x.currentTime,w.dispatch("mediatimeupdate",w)},pause:function(){clearInterval(u),w.dispatch("mediapause")},playing:function(){u=setInterval(function(){r=x.currentTime},10),w.dispatch("mediaplaying")},ended:function(){w.dispatch("mediaended")}},prepare:function(){w.duration=x.duration,o=!0;for(var a=0,b=j.length;a<b;a++){var c=j[a].trackEvents;for(var d=0,e=c.length;d<e;d++)c[d].update()}v&&v.update(),w.dispatch("mediaready")},constructing:function(){v&&v.update()},timeout:function(){w.dispatch("mediatimeout"),w.dispatch("mediafailed","timeout")},fail:function(a){w.dispatch("mediafailed","error")},playerTypeRequired:function(a){w.dispatch("mediaplayertyperequired",a)},setup:{target:p,url:n}});this.popcornCallbacks=null,this.popcornScripts=null,this.createView=function(){v||(v=new e(this,{onDropped:y}))},this.destroy=function(){x.unbind(),v&&v.destroy()},this.clear=function(){while(j.length>0)w.removeTrack(j[0])},this.addTrack=function(a){a instanceof c||(a=new c(a)),a.order=j.length,a._media=w,j.push(a),w.chain(a,["tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),a.listen("trackeventadded",z),a.listen("trackeventremoved",A),w.dispatch("trackadded",a),a.setPopcornWrapper(x);var b=a.trackEvents;if(b.length>0)for(var d=0,e=b.length;d<e;++d)a.dispatch("trackeventadded",b[d]);return a},this.getTrackById=function(a){for(var b=0,c=j.length;b<c;++b)if(j[b].id===a)return j[b]},this.removeTrack=function(a){var b=j.indexOf(a);if(b>-1){j.splice(b,1);var c=a.trackEvents;for(var d=0,e=c.length;d<e;++d)c[d].selected=!1,a.dispatch("trackeventremoved",c[d]);return w.unchain(a,["tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),a.setPopcornWrapper(null),a.unlisten("trackeventadded",z),a.unlisten("trackeventremoved",A),w.dispatch("trackremoved",a),a._media=null,a}},this.findTrackWithTrackEventId=function(a){for(var b=0,c=j.length;b<c;++b){var d=j[b].getTrackEventById(a);if(d)return{track:j[b],trackEvent:d}}},this.getManifest=function(a){return q[a]},this.setupContent=B,this.onReady=function(a){function b(c){a(c),w.unlisten("mediaready",b)}o?a():w.listen("mediaready",b)},this.pause=function(){x.pause()},this.play=function(){x.play()},this.generatePopcornString=function(a,b){var c=t||{};a=a||w.popcornCallbacks,b=b||w.popcornScripts;var d=[];for(var e=0,f=j.length;e<f;++e)d=d.concat(j[e].trackEvents);return c.frameAnimation=!1,x.generatePopcornString(c,n,p,null,a,b,d)},Object.defineProperties(this,{ended:{enumerable:!0,get:function(){return x.popcorn?x.popcorn.ended():!1}},url:{enumerable:!0,get:function(){return n},set:function(a){n!==a&&(n=a,x.clear(p),B(),w.dispatch("mediacontentchanged",w))}},target:{get:function(){return p},set:function(a){p!==a&&(x.clear(p),p=a,B(),w.dispatch("mediatargetchanged",w))},enumerable:!0},muted:{enumerable:!0,get:function(){return x.muted},set:function(a){x.muted=a}},ready:{enumerable:!0,get:function(){return o}},name:{get:function(){return m},enumerable:!0},id:{get:function(){return k},enumerable:!0},tracks:{get:function(){return j},enumerable:!0},currentTime:{get:function(){return r},set:function(a){a!==undefined&&(r=a,r<0&&(r=0),r>s&&(r=s),x.currentTime=r,w.dispatch("mediatimeupdate",w))},enumerable:!0},duration:{get:function(){return s},set:function(a){a&&(s=a,l.log("duration changed to "+s),w.dispatch("mediadurationchanged",w))},enumerable:!0},json:{get:function(){var a=[];for(var b=0,c=j.length;b<c;++b)a.push(j[b].json);return{id:k,name:m,url:n,target:p,duration:s,tracks:a}},set:function(a){a.name&&(m=a.name),a.target&&(w.target=a.target),a.url&&(w.url=a.url);if(a.tracks){var b=a.tracks;for(var d=0,e=b.length;d<e;++d){var f=new c;f.json=b[d],w.addTrack(f)}}},enumerable:!0},registry:{get:function(){return q},set:function(a){q=a},enumerable:!0},popcorn:{enumerable:!0,get:function(){return x}},paused:{enumerable:!0,get:function(){return x.paused},set:function(a){x.paused=a}},volume:{enumerable:!0,get:function(){return x.volume},set:function(a){x.volume=a}},view:{enumerable:!0,get:function(){return v}},popcornOptions:{enumerable:!0,get:function(){return t},set:function(a){t=a,w.dispatch("mediapopcornsettingschanged",w),B()}}});var C=document.getElementById(p);if(C&&["VIDEO","AUDIO"].indexOf(C.nodeName)>-1)if(!C.currentSrc&&C.getAttribute("src")||C.childNodes.length>0)var D=0,E=setInterval(function(){C.currentSrc?(n=C.currentSrc,B(),clearInterval(E)):D++===g&&clearInterval(E)},f)};return i})}(),c("text!layouts/header.html",[],function(){return'<div id="butter-header" data-butter-exclude>\n  <div class="butter-header-inner">\n    <div class="butter-logo"></div>\n    <span class="butter-name"></span>\n    <div class="butter-editor-actions">\n      <a class="butter-btn" href="#" id="butter-header-save" title="Save your project"><span class="icon-ok-sign"></span> Save</a>\n      <a class="butter-btn" href="#" id="butter-header-source" title="View the source of this template"><span class="icon-hdd"></span> View Source</a>\n      <a class="butter-btn" href="#" id="butter-header-share" title="Generate a link to share this project with the world"><span class="icon-share-alt"></span> Publish</a>\n      <a class="butter-btn" href="#" id="butter-header-auth" title="Sign in or sign up with Persona"><span class=\'icon-user\'></span>Sign In / Sign Up</a>\n    </div>\n  </div>\n</div>\n'}),c("ui/header",["dialog/iframe-dialog","util/lang","text!layouts/header.html"],function(a,b,c){var d="<span class='icon-user'></span> Sign In / Sign Up",e="Sign in or sign up with Persona";return function(f,g){function n(a,b){if(f.cornfield.authenticated()&&a&&typeof a=="function"){a();return}f.cornfield.login(function(c){c.error?(o("There was an error logging in. Please try again."),b&&b()):f.cornfield.list(function(b){r(),a&&typeof a=="function"&&a()})})}function o(b,c){var d=new a({type:"iframe",modal:!0,url:f.ui.dialogDir+"error-message.html",events:{open:function(a){d.send("message",b)},cancel:function(a){d.close(),c&&c()}}});d.open()}function p(b){function c(){f.project.html=f.getHTML(),f.project.data=f.exportProject();var a=JSON.stringify(f.project,null,4);f.ui.loadIndicator.start(),f.cornfield.save(f.project.id,a,function(a){f.ui.loadIndicator.stop();if(a.error!=="okay"||!a.project||!a.project._id){o("There was a problem saving your project. Please try again.");return}f.project.id=a.project._id,b&&b()})}if(!f.project.name){var d=new a({type:"iframe",modal:!0,url:f.ui.dialogDir+"save-as.html",events:{open:function(a){d.send("name",null)},submit:function(a){f.project.name=a.data,d.close(),c()},cancel:function(a){d.close()}}});d.open()}else c()}function q(){f.cornfield.logout(s)}function r(){m.removeEventListener("click",n,!1),m.innerHTML="<span class='icon-user'></span> "+f.cornfield.name(),m.title="This is you!",m.addEventListener("click",q,!1)}function s(){m.removeEventListener("click",q,!1),m.innerHTML=d,m.title=e,m.addEventListener("click",n,!1)}g=g||{};var h=b.domFragment(c),i,j,k,l,m;i=h.querySelector(".butter-name"),i.innerHTML=g.value("title")||"Popcorn Maker",h=document.body.insertBefore(h,document.body.firstChild),j=document.getElementById("butter-header-save"),k=document.getElementById("butter-header-source"),l=document.getElementById("butter-header-share"),m=document.getElementById("butter-header-auth"),document.body.classList.add("butter-header-spacing"),k.addEventListener("click",function(b){var c={html:f.getHTML(),json:f.exportProject()},d=new a({type:"iframe",modal:!0,url:f.ui.dialogDir+"view-source.html",events:{open:function(){d.send("export",c)},cancel:function(a){d.close()}}});d.open()},!1),l.addEventListener("click",function(b){function c(){f.cornfield.publish(f.project.id,function(b){if(b.error!=="okay"){o("There was a problem saving your project. Please try again.");return}var c=b.url,d=new a({type:"iframe",modal:!0,url:f.ui.dialogDir+"share.html",events:{open:function(a){d.send("url",c)},cancel:function(a){d.close()}}});d.open()})}function d(){f.project.id?c():p(c)}n(d)},!1),j.addEventListener("click",function(a){n(p)},!1),f.cornfield.authenticated()?r():(s(),f.listen("autologinsucceeded",function t(a){f.unlisten("autologinsucceeded",t),r()}))}}),c("ui/ui",["core/eventmanager","./toggler","./logo-spinner","./context-button","./header"],function(a,b,c,d,e){function h(b,c){var d,e=[],f=this;a(f),this.element=d=c||document.createElement("div"),d.id=b,this.items={},this.addComponent=function(a,b){var c=new i(a,b);e.push(c),d.appendChild(c.element)},this.setContentState=function(a){for(var b=0,c=e.length;b<c;++b)e[b].setState(a)}}function i(a,b){b=b||{};var c=b.transitionIn||function(){},d=b.transitionInComplete||function(){},e=b.transitionOut||function(){},g=b.transitionOutComplete||function(){},h=b.states||[],i=!1;this.element=a,this.setState=function(a){(!h||h.indexOf(a)>-1)&&!i?(i=!0,c(),setTimeout(d,f)):i&&(e(),setTimeout(g,f),i=!1)}}function j(a,b){var c,d,e;for(c in a)a.hasOwnProperty(c)&&(d=new Image,d.id=c+"-icon",d.src=b+a[c],e=document.createElement("div"),e.setAttribute("data-butter-exclude","true"),e.className="butter-image-preload",e.appendChild(d),document.body.appendChild(e))}function n(i){var n={},o=[],p=!0,q,r=i.config,s=this;a(s),n.main=new h("butter-tray"),this.contentStateLocked=!1;var t=n.main.element,u=new b(i,t);t.setAttribute("data-butter-exclude","true"),t.className="butter-tray",n.work=new h("work"),n.statusbar=new h("status-bar"),n.tools=new h("tools");var v=document.createElement("div");v.id="butter-loading-container",q=c(v),t.appendChild(v),t.appendChild(n.statusbar.element),t.appendChild(n.work.element),t.appendChild(n.tools.element),r.value("ui").enabled!==!1&&(document.body.classList.add("butter-header-spacing"),document.body.classList.add("butter-tray-spacing"),document.body.appendChild(t),i.listen("mediaadded",function(a){a.data.createView()})),this.load=function(a){r.value("ui").enabled!==!1?i.loader.load([{type:"css",url:g}],function(){j(r.value("icons"),r.value("dirs").resources||""),a()}):a()},this.registerStateToggleFunctions=function(a,b){s.listen("contentstatechanged",function(c){c.data.oldState===a&&b.transitionOut(c),c.data.newState===a&&b.transitionIn(c)})},this.pushContentState=function(a){if(s.contentStateLocked)return;var b=s.contentState;o.push(a),t.setAttribute("data-butter-content-state",s.contentState);for(var c in n)n.hasOwnProperty(c)&&n[c].setContentState(a);s.dispatch("contentstatechanged",{oldState:b,newState:s.contentState})},this.popContentState=function(){if(s.contentStateLocked)return;var a=o.pop(),b=s.contentState;t.setAttribute("data-butter-content-state",b);for(var c in n)n.hasOwnProperty(c)&&n[c].setContentState(b);return s.dispatch("contentstatechanged",{oldState:a,newState:b}),a},this.setContentState=function(a){var b=o.pop();o=[a],t.setAttribute("data-butter-content-state",a);for(var c in n)n.hasOwnProperty(c)&&n[c].setContentState(a);return s.dispatch("contentstatechanged",{oldState:b,newState:a}),b},Object.defineProperties(this,{contentState:{configurable:!1,enumerable:!0,get:function(){return o.length>0?o[o.length-1]:null}},element:{configurable:!1,enumerable:!0,get:function(){return t}},areas:{configurable:!1,enumerable:!0,get:function(){return n}},visible:{enumerable:!0,get:function(){return p},set:function(a){p!==a&&(p=a,p?(document.body.classList.remove("minimized"),t.setAttribute("ui-state","visible"),s.dispatch("uivisibilitychanged",!0)):(document.body.classList.add("minimized"),t.setAttribute("ui-state","hidden"),s.dispatch("uivisibilitychanged",!1)))}}});var w=i.orderedTrackEvents=[],x=function(a,b){return a.popcornOptions.start>b.popcornOptions.start};i.listen("trackeventadded",function(a){w.push(a.data),w.sort(x)}),i.listen("trackeventremoved",function(a){var b=w.indexOf(a.data);b>-1&&w.splice(b,1)}),i.listen("trackeventupdated",function(a){w.sort(x)});var y=i.orderedTracks=[],z=function(a,b){return a.order>b.order};i.listen("trackadded",function(a){a.data.listen("trackorderchanged",function(a){y.sort(z)}),y.push(a.data),y.sort(z)}),i.listen("trackremoved",function(a){var b=y.indexOf(a.data);b>-1&&y.splice(b,1)});var A={32:function(a){a.preventDefault(),i.currentMedia.ended?i.currentMedia.paused=!1:i.currentMedia.paused=!i.currentMedia.paused},37:function(a){var b=a.shiftKey?m:l;if(i.selectedEvents.length){a.preventDefault();for(var c=0,d=i.selectedEvents.length;c<d;c++)i.selectedEvents[c].moveFrameLeft(b,a.ctrlKey||a.metaKey)}else i.currentTime-=b},38:function(a){var b,c,d;i.selectedEvents.length&&a.preventDefault();for(var e=0,f=i.selectedEvents.length;e<f;e++)c=i.selectedEvents[e],b=c.track,d=y[y.indexOf(b)-1],d&&(b.removeTrackEvent(c),d.addTrackEvent(c))},39:function(a){a.preventDefault();var b=a.shiftKey?m:l;if(i.selectedEvents.length)for(var c=0,d=i.selectedEvents.length;c<d;c++)i.selectedEvents[c].moveFrameRight(b,a.ctrlKey||a.metaKey);else i.currentTime+=b},40:function(a){var b,c,d;i.selectedEvents.length&&a.preventDefault();for(var e=0,f=i.selectedEvents.length;e<f;e++)c=i.selectedEvents[e],b=c.track,d=y[y.indexOf(b)+1],d&&(b.removeTrackEvent(c),d.addTrackEvent(c))},27:function(a){for(var b=0;b<i.selectedEvents.length;b++)i.selectedEvents[b].selected=!1;i.selectedEvents=[]},8:function(a){if(i.selectedEvents.length){a.preventDefault();for(var b=0;b<i.selectedEvents.length;b++)i.selectedEvents[b].track.removeTrackEvent(i.selectedEvents[b]);i.selectedEvents=[]}},9:function(a){if(w.length&&i.selectedEvents.length<=1){a.preventDefault();var b=0,c=a.shiftKey?-1:1;w.indexOf(i.selectedEvents[0])>-1&&(b=w.indexOf(i.selectedEvents[0]),w[b+c]?b+=c:a.shiftKey?b=w.length-1:b=0);for(var d=0;d<i.selectedEvents.length;d++)i.selectedEvents[d].selected=!1;i.selectedEvents=[],w[b].selected=!0,i.selectedEvents.push(w[b])}}};window.addEventListener("keydown",function(a){var b=a.which||a.keyCode;b=b===46?8:b,A[b]&&k.indexOf(a.target.nodeName)===-1&&A[b](a)},!1),this.TRANSITION_DURATION=f,u.visible=!1,s.visible=!1,this.loadIndicator={start:function(){q.start(),v.style.display="block"},stop:function(){q.stop(function(){v.style.display="none"})}},s.loadIndicator.start(),i.listen("ready",function(){s.loadIndicator.stop(),s.visible=!0,u.visible=!0,d(i),r.value("ui").enabled!==!1&&e(i,r)}),s.dialogDir=i.config.value("dirs").dialogs||""}var f=500,g="{css}/butter.ui.css",k=["TEXTAREA","INPUT","VIDEO","AUDIO"],l=.25,m=1;return n.__moduleName="ui",n}),function(){var a=1,b=.01,d={Chrome:17,Firefox:10};c("main",["core/eventmanager","core/logger","core/config","core/target","core/media","core/page","./modules","./dependencies","ui/ui","util/xhr","util/lang","text!default-config.json","text!layouts/ua-warning.html"],function(c,e,f,g,h,i,j,k,l,m,n,o,p){function t(n){function L(){if(!y)throw new Error("No media object is selected")}function M(c,d,e){var f,g=c.getAttribute("data-butter-plugin-type"),h=d.currentTime,i;h>d.duration&&(h=d.duration-a),h<0&&(h=0),i=h+a,i>d.duration&&(i=d.duration);if(!g){B.log("Invalid trackevent type requested.");return}d.tracks.length===0&&d.addTrack(),f=d.tracks[0];var j=f.addTrackEvent({type:g,popcornOptions:{start:h,end:i,target:e}});return d.currentTime<d.duration-b&&(d.currentTime+=b),j}function N(a){if(y){var b=M(a.data.element,y,a.target.elementID);G.dispatch("trackeventcreated",{trackEvent:b,by:"target"})}else B.log("Warning: No media to add dropped trackevent.")}function O(a){C.addPlayerType(a.data)}function P(a){var b=M(a.data,a.target,y.target);G.dispatch("trackeventcreated",{trackEvent:b,by:"media"})}function S(a){var b;window.location.search.substring(1).split("&").forEach(function(a){a=a.split("="),a&&a[0]==="savedDataUrl"&&(b=a[1])}),b=b||D.value("savedDataUrl");if(b){var c=new XMLHttpRequest,d;b+="?noCache="+Date.now(),c.open("GET",b,!1),c.overrideMimeType&&c.overrideMimeType("application/json"),c.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),c.send(null);if(c.status===200){try{d=JSON.parse(c.responseText)}catch(e){G.dispatch("loaddataerror","Saved data not formatted properly.")}G.project.id=d.projectID,G.project.name=d.name,G.importProject(d)}else B.log("Butter saved data not found: "+b)}a()}function T(a){a&&E.merge(a),D=E,G.project.template=D.value("name");var b=j(G,D),c=k(D);G.loader=c,C=new i(c,D),G.ui=new l(G),G.ui.load(function(){R(function(){Q(function(){b.ready(function(){D.value("snapshotHTMLOnReady")&&C.snapshotHTML(),S(function(){G.dispatch("ready",G)})})})})})}var p=navigator.userAgent,t;for(var u in d)if(d.hasOwnProperty(u)){var v=new RegExp(u+"/([0-9]+)\\.","g"),w=v.exec(p);w&&w.length===2&&Number(w[1])>=d[u]&&(t=u+"/"+w[1])}t||s.showUAWarning(),n=n||{};var x=[],y,z=[],A="Butter"+q++,B=new e(A),C,D,E,F,G=this,H=[],I={},J={};try{E=f.parse(o)}catch(K){throw"Butter Error: unable to find or parse default-config.json"}n.debug!==undefined&&e.enabled(n.debug),c(G),this.project={id:null,name:null,data:null,html:null,template:null},this.getManifest=function(a){return L(),y.getManifest(a)},this.getHTML=function(){var a=[];for(var b=0;b<x.length;++b)a.push(x[b].generatePopcornString());return C.getHTML(a)},this.addTarget=function(a){return a instanceof g||(a=new g(a)),z.push(a),a.listen("trackeventrequested",N),B.log("Target added: "+a.name),G.dispatch("targetadded",a),a.isDefault&&(F=a),a},this.removeTarget=function(a){typeof a=="string"&&(a=G.getTargetByType("id",a));var b=z.indexOf(a);return b>-1?(a.unlisten("trackeventrequested",N),z.splice(b,1),delete z[a.name],G.dispatch("targetremoved",a),F===a&&(F=undefined),a):undefined},this.serializeTargets=function(){var a=[];for(var b=0,c=z.length;b<c;++b)a.push(z[b].json);return a},this.getTargetByType=function(a,b){for(var c=0,d=z.length;c<d;c++)if(z[c][a]===b)return z[c];return undefined},this.importProject=function(a){var b,c;if(a.targets)for(b=0,c=a.targets.length;b<c;++b){var d,e=G.targets,f=a.targets[b];for(var g=0,i=e.length;g<i;++g)if(e[g].name===f.name){d=e[g];break}d?d.json=f:G.addTarget(f)}if(a.media)for(b=0,c=a.media.length;b<c;++b){var j=a.media[b],k=G.getMediaByType("target",j.target);k?k.json=j:(k=new h,k.json=j,G.addMedia(k))}},this.exportProject=function(){var a=[];for(var b=0,c=x.length;b<c;++b)a.push(x[b].json);var d={targets:G.serializeTargets(),media:a};return d},this.clearProject=function(){var a=this.orderedTrackEvents;while(a.length>0)a[0].track.removeTrackEvent(a[0]);while(z.length>0)z[0].destroy(),G.removeTarget(z[0]);while(x.length>0)x[0].destroy(),G.removeMedia(x[0])},this.getMediaByType=function(a,b){for(var c=0,d=x.length;c<d;c++)if(x[c][a]===b)return x[c];return undefined},this.addMedia=function(a){a instanceof h||(a=new h(a)),a.popcornCallbacks=J,a.popcornScripts=I,x.push(a),G.chain(a,["mediacontentchanged","mediadurationchanged","mediatargetchanged","mediatimeupdate","mediaready","trackadded","trackremoved","tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventeditrequested"]);var b;if(a.tracks.length>0)for(var c=0,d=a.tracks.length;c<d;++c){var e=a.tracks[c];b=e.trackEvents,a.dispatch("trackadded",e);if(b.length>0)for(var f=0,g=b.length;f<g;++f)e.dispatch("trackeventadded",b[f])}return a.listen("trackeventrequested",P),a.listen("mediaplayertyperequired",O),G.dispatch("mediaadded",a),y||(G.currentMedia=a),a.setupContent(),a},this.removeMedia=function(a){var b=x.indexOf(a);if(b>-1){x.splice(b,1),G.unchain(a,["mediacontentchanged","mediadurationchanged","mediatargetchanged","mediatimeupdate","mediaready","trackadded","trackremoved","tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventeditrequested"]);var c=a.tracks;for(var d=0,e=c.length;d<e;++d)G.dispatch("trackremoved",c[d]);return a===y&&(y=undefined),a.unlisten("trackeventrequested",P),a.unlisten("mediaplayertyperequired",O),G.dispatch("mediaremoved",a),a}return undefined},this.extend=function(){s.extend(G,[].slice.call(arguments,1))},Object.defineProperties(G,{defaultTarget:{enumerable:!0,get:function(){return F}},config:{enumerable:!0,get:function(){return D}},id:{get:function(){return A},enumerable:!0},tracks:{get:function(){return y.tracks},enumerable:!0},targets:{get:function(){return z},enumerable:!0},currentTime:{get:function(){return L(),y.currentTime},set:function(a){L(),y.currentTime=a},enumerable:!0},duration:{get:function(){return L(),y.duration},set:function(a){L(),y.duration=a},enumerable:!0},media:{get:function(){return x},enumerable:!0},currentMedia:{get:function(){return y},set:function(a){typeof a=="string"&&(a=G.getMediaByType("id",a.id));if(a&&x.indexOf(a)>-1)return y=a,B.log("Media Changed: "+a.name),G.dispatch("mediachanged",a),y},enumerable:!0},selectedEvents:{get:function(){return H},set:function(a){H=a},enumerable:!0},debug:{get:function(){return e.enabled()},set:function(a){e.enabled(a)},enumerable:!0}});var Q=this.preparePage=function(a){var b=C.scrape(),c=b.target,d=b.media;C.prepare(function(){if(!!D.value("scrapePage")){var b,e,f,g,h,i,j,k,l;for(b=0,f=c.length;b<f;++b){i=null;if(z.length>0)for(e=0,g=z.length;e<g;++e)if(z[e].id===c[b].id){i=z[e];break}i||G.addTarget({element:c[b].id})}for(b=0,f=d.length;b<f;b++){j=null,k=null,h="",l=d[b],l.getAttribute("data-butter-source")?h=l.getAttribute("data-butter-source"):["VIDEO","AUDIO"].indexOf(l.nodeName)>-1&&(h=l.currentSrc);if(x.length>0){for(e=0,g=x.length;e<g;++e)if(x[e].id!==d[b].id&&x[e].url!==h){j=x[e];break}}else D.value("mediaDefaults")&&(k=D.value("mediaDefaults"));j||G.addMedia({target:d[b].id,url:h,popcornOptions:k})}}a&&a(),G.dispatch("pageready")})};r.push(this),n.ready&&G.listen("ready",function(a){n.ready(a.data)});var R=this.preparePopcornScriptsAndCallbacks=function(a){function g(b){return function(c){this.readyState===4&&(this.status!==200?(I[b]="",B.log("WARNING: Trouble loading Popcorn script: "+this.response)):I[b]=this.response,++f,f===e.length&&a&&a())}}var b=D.value("popcorn")||{},c=b.callbacks,d=b.scripts,e=[],f=0;J=c;for(var h in d)if(d.hasOwnProperty(h)){var i=d[h],j=document.getElementById(i.substring(1));i.indexOf("#")===0?j&&(I[h]=j.innerHTML):e.push({url:i,onLoad:g(h)})}if(e.length>0)for(var k=0;k<e.length;++k)m.get(e[k].url,e[k].onLoad);else a()};if(n.config&&typeof n.config=="string"){var U=new XMLHttpRequest,V,W=n.config+"?noCache="+Date.now();U.open("GET",W,!1),U.overrideMimeType&&U.overrideMimeType("application/json"),U.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),U.send(null);if(U.status===200||U.status===0){try{V=f.parse(U.responseText)}catch(K){throw new Error("Butter config file not formatted properly.")}T(V)}else G.dispatch("configerror",G)}else T(n.config);this.page=C}var q=0,r=[],s=function(a){return new t(a)};s.showUAWarning=function(){var a=n.domFragment(p);document.body.appendChild(a),a.classList.add("slide-out"),a.getElementsByClassName("close-button")[0].onclick=function(){document.body.removeChild(a)}},s.instances=r,s.version="0.5";if(window.Butter.__waiting){for(var u=0,v=window.Butter.__waiting.length;u<v;++u)s.apply({},window.Butter.__waiting[u]);delete s._waiting}return window.Butter=s,s})}()})()